<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√°c v·∫≠t t∆∞ ƒë√£ xu·∫•t trong d·ª± √°n - H·ªá th·ªëng qu·∫£n l√Ω c·ª≠a nh√¥m k√≠nh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="css/sidebar-enterprise.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Sidebar and main-content styles are now in sidebar-enterprise.css */
        /* Keeping only page-specific styles here */

        .header-gradient {
            background: linear-gradient(135deg, #8B5CF6 0%, #3B82F6 100%);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1000;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        .project-card {
            transition: all 0.3s ease;
        }

        .project-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
    </style>
    <link rel="stylesheet" href="css/notification-header.css">
</head>

<body>

    <!-- Header Notification (Top Right) -->
    <div class="header-notification-container">
        <button id="headerNotificationButton" class="header-notification-button" onclick="toggleHeaderNotifications()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
            </svg>
            <span id="headerNotificationBadge" class="header-notification-badge hidden">0</span>
        </button>

        <div id="headerNotificationsDropdown" class="header-notifications-dropdown">
            <div class="header-notifications-header">
                <h3>Th√¥ng b√°o</h3>
            </div>
            <div id="headerNotificationsList" class="header-notifications-list">
                <!-- Notifications will be loaded here -->
            </div>
        </div>
    </div>

    <!-- SIDEBAR -->
    <div class="sidebar text-white">
        <!-- Logo -->
        <a href="settings.html" class="sidebar-logo block">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-blue-400 rounded-lg flex items-center justify-center overflow-hidden flex-shrink-0"
                    id="companyLogoContainer">
                    <img id="companyLogo" src="" alt="Logo" class="hidden w-full h-full object-contain">
                    <svg id="companyLogoIcon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" class="w-6 h-6 text-white">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <span class="text-xl font-bold" id="companyName">ViralWindow</span>
            </div>
        </a>

        <!-- User Profile -->
        <div class="p-4 border-b border-blue-600 relative">
            <div class="flex items-center gap-3 cursor-pointer hover:bg-blue-700 rounded-lg p-2"
                onclick="toggleSidebarUserMenu()">
                <div class="w-10 h-10 bg-blue-400 rounded-full flex items-center justify-center font-semibold overflow-hidden"
                    id="sidebarUserAvatar">
                    <div id="sidebarUserAvatarInitial">U</div>
                    <img id="sidebarUserAvatarImage" src="" alt="Avatar"
                        class="hidden w-full h-full object-cover rounded-full">
                </div>
                <div class="flex-1 min-w-0">
                    <div class="font-medium text-sm" id="sidebarUserName">L√™ VƒÉn H·∫£i</div>
                    <div class="text-xs text-blue-200">Qu·∫£n l√Ω</div>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                    class="w-4 h-4">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
            <!-- User Menu Dropdown -->
            <div id="sidebarUserMenuDropdown"
                class="hidden absolute left-0 right-0 mt-2 bg-white rounded-lg shadow-xl z-[9999] border border-gray-200">
                <div class="p-2">
                    <a href="profile.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded">H·ªì
                        s∆°</a>
                    <a href="settings.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded">C√†i
                        ƒë·∫∑t</a>
                    <hr class="my-2">
                    <button onclick="handleLogout()"
                        class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100 rounded">ƒêƒÉng
                        xu·∫•t</button>
                </div>
            </div>
        </div>

        <!-- Navigation Menu -->
        <nav class="sidebar-nav">
            <!-- T·ªîNG QUAN -->
            <a href="index.html" class="nav-item">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                    class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                </svg>
                <span>T·ªîNG QUAN</span>
            </a>

            <!-- KINH DOANH -->
            <div class="nav-item has-submenu expanded">
                <div class="flex items-center gap-3 flex-1">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                    <span>KINH DOANH</span>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                    class="w-4 h-4 transition-transform duration-200 arrow-icon">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
            <div class="submenu expanded">
                <a href="sales.html" class="submenu-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    <span>Kh√°ch h√†ng & D·ª± √°n</span>
                </a>
                <a href="quotation-new.html" class="submenu-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <span>B√°o gi√°</span>
                </a>
            </div>

            <!-- K·ª∏ THU·∫¨T -->
            <div class="nav-item has-submenu">
                <div class="flex items-center gap-3 flex-1">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <span>K·ª∏ THU·∫¨T</span>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                    class="w-4 h-4 transition-transform duration-200 arrow-icon">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
            <div class="submenu">
                <a href="design-new.html" class="submenu-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" />
                    </svg>
                    <span>Thi·∫øt k·∫ø & B√≥c t√°ch</span>
                </a>
                <a href="material-requests.html" class="submenu-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <span>Y√™u c·∫ßu v·∫≠t t∆∞</span>
                </a>
            </div>

            <!-- S·∫¢N XU·∫§T -->
            <div class="nav-item has-submenu">
                <div class="flex items-center gap-3 flex-1">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
                    </svg>
                    <span>S·∫¢N XU·∫§T</span>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                    class="w-4 h-4 transition-transform duration-200 arrow-icon">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
            <div class="submenu">
                <a href="production.html" class="submenu-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
                    </svg>
                    <span>Quy tr√¨nh s·∫£n xu·∫•t</span>
                </a>
                <a href="production-management.html" class="submenu-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <span>L·ªánh s·∫£n xu·∫•t</span>
                </a>
            </div>

            <!-- KHO & V·∫¨T T∆Ø -->
            <div class="nav-item has-submenu expanded">
                <div class="flex items-center gap-3 flex-1">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                    </svg>
                    <span>KHO & V·∫¨T T∆Ø</span>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                    class="w-4 h-4 transition-transform duration-200 arrow-icon">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
            <div class="submenu expanded">
                <a href="inventory.html" class="submenu-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4" />
                    </svg>
                    <span>Kho v·∫≠t t∆∞</span>
                </a>
                <a href="exported-materials.html" class="submenu-item active">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                    </svg>
                    <span>Xu·∫•t v·∫≠t t∆∞</span>
                </a>
            </div>

            <!-- THI C√îNG & NGHI·ªÜM THU -->
            <div class="nav-item has-submenu">
                <div class="flex items-center gap-3 flex-1">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    <span>THI C√îNG & NGHI·ªÜM THU</span>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                    class="w-4 h-4 transition-transform duration-200 arrow-icon">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
            <div class="submenu">
                <a href="installation.html" class="submenu-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    <span>L·∫Øp ƒë·∫∑t</span>
                </a>
                <a href="handover.html" class="submenu-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                    </svg>
                    <span>B√†n giao</span>
                </a>
            </div>

            <!-- T√ÄI CH√çNH -->
            <div class="nav-item has-submenu">
                <div class="flex items-center gap-3 flex-1">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <span>T√ÄI CH√çNH</span>
                </div>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                    class="w-4 h-4 transition-transform duration-200 arrow-icon">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </div>
            <div class="submenu">
                <a href="finance-dashboard.html" class="submenu-item">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-5 h-5">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    <span>T√†i ch√≠nh</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">
        <!-- Top Header Bar -->
        <div class="bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-semibold text-gray-800">C√°c v·∫≠t t∆∞ ƒë√£ xu·∫•t trong d·ª± √°n</h1>
                <p class="text-sm text-gray-500 mt-1">Danh s√°ch v·∫≠t t∆∞ ƒë√£ xu·∫•t v√† chuy·ªÉn sang quy tr√¨nh s·∫£n xu·∫•t</p>
            </div>
            <div class="flex items-center gap-4">
                <!-- User Menu -->
                <div class="relative">
                    <button onclick="toggleHeaderUserMenu()"
                        class="flex items-center gap-2 p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition">
                        <div class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-semibold overflow-hidden"
                            id="headerUserAvatar">
                            <div id="headerUserAvatarInitial">U</div>
                            <img id="headerUserAvatarImage" src="" alt="Avatar"
                                class="hidden w-full h-full object-cover rounded-full">
                        </div>
                    </button>
                    <!-- User Dropdown -->
                    <div id="userMenuDropdown"
                        class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl z-[9999] border border-gray-200">
                        <div class="p-2">
                            <a href="profile.html"
                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded">H·ªì s∆°</a>
                            <a href="settings.html"
                                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded">C√†i ƒë·∫∑t</a>
                            <hr class="my-2">
                            <button onclick="handleLogout()"
                                class="block w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-gray-100 rounded">ƒêƒÉng
                                xu·∫•t</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="p-6">
            <!-- Ph·∫ßn th·ªëng k√™ t·ªïng quan ƒë√£ ƒë∆∞·ª£c lo·∫°i b·ªè theo y√™u c·∫ßu doanh nghi·ªáp -->
            <!-- Th√¥ng tin th·ªëng k√™ gi·ªù ƒë∆∞·ª£c hi·ªÉn th·ªã khi xem chi ti·∫øt t·ª´ng d·ª± √°n -->

            <!-- DANH S√ÅCH D·ª∞ √ÅN -->
            <div id="projectListSection" class="bg-white rounded-xl shadow p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-gray-800">Ch·ªçn d·ª± √°n ƒë·ªÉ xu·∫•t v·∫≠t t∆∞</h2>
                    <div class="flex-1 max-w-md ml-4">
                        <input type="text" id="projectSearchInput" placeholder="T√¨m ki·∫øm d·ª± √°n..."
                            oninput="filterProjects()"
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                </div>
                <div id="projectsList" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Danh s√°ch d·ª± √°n s·∫Ω ƒë∆∞·ª£c load ·ªü ƒë√¢y -->
                    <div class="col-span-full text-center py-8 text-gray-500">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                            class="w-12 h-12 mx-auto mb-2 opacity-50">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                        <p>ƒêang t·∫£i danh s√°ch d·ª± √°n...</p>
                    </div>
                </div>
            </div>

            <!-- XU·∫§T V·∫¨T T∆Ø CHO D·ª∞ √ÅN (·∫®n cho ƒë·∫øn khi ch·ªçn d·ª± √°n) -->
            <div id="exportMaterialsSection" class="hidden">
                <!-- Th√¥ng tin d·ª± √°n ƒë√£ ch·ªçn -->
                <div class="bg-gradient-to-r from-indigo-500 to-blue-500 rounded-xl shadow p-4 mb-6 text-white">
                    <div class="flex justify-between items-center">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <button onclick="backToProjectList()"
                                    class="p-2 hover:bg-white/20 rounded-lg transition-colors"
                                    title="Quay l·∫°i danh s√°ch d·ª± √°n">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke="currentColor" class="w-5 h-5">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                                    </svg>
                                </button>
                                <div>
                                    <h3 class="font-bold text-lg" id="selectedProjectName">-</h3>
                                    <p class="text-sm opacity-90" id="selectedProjectCustomer">Kh√°ch h√†ng: -</p>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-6">
                            <div class="text-right">
                                <p class="text-2xl font-bold" id="selectedProjectTotalCost">0 ‚Ç´</p>
                                <p class="text-sm opacity-90">T·ªïng chi ph√≠ v·∫≠t t∆∞</p>
                            </div>
                            <button onclick="openAddMaterialModal()" id="btnAddMaterial"
                                class="bg-white text-indigo-600 px-4 py-2 rounded-lg font-semibold flex items-center gap-2 hover:bg-gray-100 shadow-lg">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor" class="w-5 h-5">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4" />
                                </svg>
                                Th√™m v·∫≠t t∆∞
                            </button>
                            <button onclick="confirmMaterialExport()" id="btnConfirmExport"
                                class="bg-white text-indigo-600 px-6 py-2 rounded-lg font-semibold flex items-center gap-2 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg"
                                disabled>
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor" class="w-5 h-5">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                X√°c nh·∫≠n xu·∫•t
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Thanh t√¨m ki·∫øm v√† filter -->
                <div class="bg-white rounded-xl shadow p-6 mb-6">
                    <div class="flex gap-4 items-end">
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-2">T√¨m ki·∫øm v·∫≠t t∆∞</label>
                            <input type="text" id="exportMaterialSearch" placeholder="T√¨m ki·∫øm theo t√™n v·∫≠t t∆∞..."
                                oninput="filterExportedMaterials()"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div id="exportSystemFilterContainer" style="min-width: 250px;">
                            <label class="block text-sm font-medium text-gray-700 mb-2">H·ªá</label>
                            <select id="exportSystemFilter" onchange="filterExportedMaterials()"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="">T·∫•t c·∫£ h·ªá</option>
                                <option value="VRA ‚Äì H·ªá 55 m·ªü quay">VRA ‚Äì H·ªá 55 m·ªü quay</option>
                                <option value="VRA ‚Äì H·ªá 50">VRA ‚Äì H·ªá 50</option>
                                <option value="VRA ‚Äì H·ªá 64 (c·ª≠a s·ªï l√πa)">VRA ‚Äì H·ªá 64 (c·ª≠a s·ªï l√πa)</option>
                                <option value="VRE ‚Äì H·ªá 65 m·ªü quay (M·∫°nh Quy)">VRE ‚Äì H·ªá 65 m·ªü quay (M·∫°nh Quy)</option>
                                <option value="VRE ‚Äì H·ªá 65 m·ªü quay (Yangly)">VRE ‚Äì H·ªá 65 m·ªü quay (Yangly)</option>
                                <option value="VRE ‚Äì H·ªá x·∫øp tr∆∞·ª£t 80">VRE ‚Äì H·ªá x·∫øp tr∆∞·ª£t 80</option>
                                <option value="VRE ‚Äì H·ªá l√πa 120 & 180">VRE ‚Äì H·ªá l√πa 120 & 180</option>
                                <option value="H·ªá l√πa 94 m·ªõi">H·ªá l√πa 94 m·ªõi</option>
                                <option value="Th·ªßy l·ª±c">Th·ªßy l·ª±c</option>
                                <option value="M·∫∑t d·ª±ng">M·∫∑t d·ª±ng</option>
                            </select>
                        </div>
                        <div id="exportTypeFilterContainer" style="min-width: 150px;">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Lo·∫°i</label>
                            <select id="exportTypeFilter" onchange="filterExportedMaterials()"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="">T·∫•t c·∫£ lo·∫°i</option>
                                <option value="accessory">Ph·ª• ki·ªán</option>
                                <option value="aluminum">Kho nh√¥m</option>
                                <option value="glass">K√≠nh</option>
                                <option value="other">V·∫≠t t∆∞ ph·ª•</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Danh s√°ch v·∫≠t t∆∞ ƒë√£ xu·∫•t (ƒë·ªß kho) -->
                <div id="exportedMaterialsSection" class="bg-white rounded-xl shadow overflow-hidden mb-6">
                    <div class="p-4 bg-green-50 border-b border-green-200">
                        <h3 class="text-lg font-semibold text-green-800">‚úÖ Danh s√°ch v·∫≠t t∆∞ ƒë√£ xu·∫•t (<span
                                id="exportedCount">0</span>)</h3>
                        <p class="text-sm text-green-600 mt-1">C√°c v·∫≠t t∆∞ n√†y ƒë√£ ƒë∆∞·ª£c xu·∫•t th√†nh c√¥ng v√¨ trong kho c√≥ ƒë·ªß
                            s·ªë l∆∞·ª£ng</p>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">T√äN V·∫¨T
                                        T∆Ø</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">LO·∫†I
                                    </th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">S·ªê L∆Ø·ª¢NG
                                    </th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">ƒê∆†N GI√Å
                                    </th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">TH√ÄNH
                                        TI·ªÄN</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">T·ªíN KHO
                                    </th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">GHI CH√ö
                                    </th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">THAO T√ÅC
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200" id="exportedMaterialsTable">
                                <tr>
                                    <td colspan="8" class="px-4 py-8 text-center text-gray-500">
                                        Ch·ªçn d·ª± √°n ƒë·ªÉ xem v·∫≠t t∆∞ ƒë√£ xu·∫•t
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Danh s√°ch v·∫≠t t∆∞ ch∆∞a ƒë∆∞·ª£c xu·∫•t (thi·∫øu kho) -->
                <div id="insufficientMaterialsSection" class="bg-white rounded-xl shadow overflow-hidden mb-6">
                    <div class="p-4 bg-orange-50 border-b border-orange-200">
                        <h3 class="text-lg font-semibold text-orange-800">‚ö†Ô∏è Danh s√°ch v·∫≠t t∆∞ ch∆∞a ƒë∆∞·ª£c xu·∫•t (<span
                                id="insufficientCount">0</span>)</h3>
                        <p class="text-sm text-orange-600 mt-1">C√°c v·∫≠t t∆∞ n√†y ch∆∞a th·ªÉ xu·∫•t v√¨ trong kho kh√¥ng c√≥ ho·∫∑c
                            kh√¥ng ƒë·ªß. C·∫ßn b·ªï sung v√†o kho tr∆∞·ªõc khi xu·∫•t.</p>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">T√äN V·∫¨T
                                        T∆Ø</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">LO·∫†I
                                    </th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">C·∫¶N</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">T·ªíN KHO
                                    </th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">THI·∫æU
                                    </th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">TR·∫†NG
                                        TH√ÅI</th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">GHI CH√ö
                                    </th>
                                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">THAO T√ÅC
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200" id="insufficientMaterialsTable">
                                <tr>
                                    <td colspan="8" class="px-4 py-8 text-center text-gray-500">
                                        Kh√¥ng c√≥ v·∫≠t t∆∞ ch∆∞a ƒë·ªß
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- FILTER AND SEARCH -->
            <div class="bg-white rounded-xl shadow p-6 mb-6">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <input type="text" id="searchInput"
                            placeholder="T√¨m ki·∫øm theo m√£ d·ª± √°n, t√™n d·ª± √°n, kh√°ch h√†ng..."
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                            onkeyup="filterProjects()">
                    </div>
                    <select id="statusFilter"
                        class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        onchange="filterProjects()">
                        <option value="all">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                        <option value="in_production">ƒêang s·∫£n xu·∫•t</option>
                        <option value="completed">ƒê√£ ho√†n th√†nh</option>
                    </select>
                </div>
            </div>

            <!-- PROJECTS LIST - Danh s√°ch d·ª± √°n ƒë√£ xu·∫•t v·∫≠t t∆∞ -->
            <div id="exportedProjectsList" class="space-y-4">
                <!-- Projects will be loaded here -->
            </div>

            <!-- CHI TI·∫æT V·∫¨T T∆Ø C·ª¶A D·ª∞ √ÅN (2 c·ªôt: ƒë√£ xu·∫•t | ch∆∞a xu·∫•t) -->
            <div id="projectMaterialsDetail" class="hidden">
                <!-- Header v·ªõi n√∫t quay l·∫°i -->
                <div class="bg-white rounded-xl shadow p-4 mb-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <button onclick="backToProjectsList()"
                                class="mb-2 text-indigo-600 hover:text-indigo-800 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor" class="w-5 h-5">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                                </svg>
                                Quay l·∫°i danh s√°ch d·ª± √°n
                            </button>
                            <h2 class="text-2xl font-bold text-gray-800" id="detailProjectName">-</h2>
                            <p class="text-gray-600 mt-1" id="detailProjectCustomer">-</p>
                        </div>
                        <!-- N√∫t Phi·∫øu xu·∫•t v√† Xu·∫•t Excel -->
                        <div class="flex gap-3">
                            <button onclick="showExportSlipModal()"
                                class="px-4 py-2 bg-indigo-600 text-white rounded-lg flex items-center gap-2 hover:bg-indigo-700 transition font-semibold">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor" class="w-5 h-5">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                üìÑ Phi·∫øu xu·∫•t kho
                            </button>
                            <button onclick="exportToExcel()"
                                class="px-4 py-2 bg-green-600 text-white rounded-lg flex items-center gap-2 hover:bg-green-700 transition font-semibold">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor" class="w-5 h-5">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                üìä Xu·∫•t Excel
                            </button>
                        </div>
                    </div>

                    <!-- TH·ªêNG K√ä V·∫¨T T∆Ø THEO LO·∫†I (M·ªõi th√™m theo y√™u c·∫ßu doanh nghi·ªáp) -->
                    <div class="bg-white rounded-xl shadow p-4 mb-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">üìä Th·ªëng k√™ v·∫≠t t∆∞ d·ª± √°n</h3>

                        <!-- T·ªïng quan -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                            <div class="bg-green-50 rounded-lg p-3 text-center">
                                <p class="text-sm text-green-600 font-medium">ƒê√£ xu·∫•t</p>
                                <p class="text-2xl font-bold text-green-700" id="statExportedTotal">0</p>
                                <p class="text-xs text-green-500">v·∫≠t t∆∞</p>
                            </div>
                            <div class="bg-orange-50 rounded-lg p-3 text-center">
                                <p class="text-sm text-orange-600 font-medium">Ch∆∞a xu·∫•t</p>
                                <p class="text-2xl font-bold text-orange-700" id="statUnexportedTotal">0</p>
                                <p class="text-xs text-orange-500">v·∫≠t t∆∞</p>
                            </div>
                            <div class="bg-blue-50 rounded-lg p-3 text-center">
                                <p class="text-sm text-blue-600 font-medium">T·ªïng gi√° tr·ªã ƒë√£ xu·∫•t</p>
                                <p class="text-xl font-bold text-blue-700" id="statExportedValue">0 ‚Ç´</p>
                            </div>
                            <div class="bg-purple-50 rounded-lg p-3 text-center">
                                <p class="text-sm text-purple-600 font-medium">T·ª∑ l·ªá ho√†n th√†nh</p>
                                <p class="text-2xl font-bold text-purple-700" id="statCompletionRate">0%</p>
                            </div>
                        </div>

                        <!-- Ph√¢n lo·∫°i theo lo·∫°i v·∫≠t t∆∞ -->
                        <div class="border-t pt-4">
                            <h4 class="text-sm font-medium text-gray-600 mb-3">Ph√¢n lo·∫°i theo lo·∫°i v·∫≠t t∆∞:</h4>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <div class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg">
                                    <span class="text-xl">üîß</span>
                                    <div>
                                        <p class="text-sm font-medium text-gray-700">Nh√¥m</p>
                                        <p class="text-xs text-gray-500">
                                            <span class="text-green-600" id="statAluminumExported">0</span> /
                                            <span class="text-orange-600" id="statAluminumUnexported">0</span>
                                        </p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg">
                                    <span class="text-xl">ü™ü</span>
                                    <div>
                                        <p class="text-sm font-medium text-gray-700">K√≠nh</p>
                                        <p class="text-xs text-gray-500">
                                            <span class="text-green-600" id="statGlassExported">0</span> /
                                            <span class="text-orange-600" id="statGlassUnexported">0</span>
                                        </p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg">
                                    <span class="text-xl">‚öôÔ∏è</span>
                                    <div>
                                        <p class="text-sm font-medium text-gray-700">Ph·ª• ki·ªán</p>
                                        <p class="text-xs text-gray-500">
                                            <span class="text-green-600" id="statAccessoryExported">0</span> /
                                            <span class="text-orange-600" id="statAccessoryUnexported">0</span>
                                        </p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2 p-2 bg-gray-50 rounded-lg">
                                    <span class="text-xl">üì¶</span>
                                    <div>
                                        <p class="text-sm font-medium text-gray-700">V·∫≠t t∆∞ ph·ª•</p>
                                        <p class="text-xs text-gray-500">
                                            <span class="text-green-600" id="statOtherExported">0</span> /
                                            <span class="text-orange-600" id="statOtherUnexported">0</span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Layout d·ªçc: V·∫≠t t∆∞ ƒë√£ xu·∫•t ·ªü tr√™n, Ch∆∞a xu·∫•t ·ªü d∆∞·ªõi (ƒê√£ ƒë·ªïi t·ª´ 2 c·ªôt sang 1 c·ªôt) -->
                    <div class="space-y-6">
                        <!-- B·∫£ng 1: V·∫≠t t∆∞ ƒë√£ xu·∫•t -->
                        <div class="bg-white rounded-xl shadow overflow-hidden">
                            <div class="p-4 bg-green-50 border-b border-green-200 flex justify-between items-center">
                                <div>
                                    <h3 class="text-lg font-semibold text-green-800">‚úÖ V·∫≠t t∆∞ ƒë√£ xu·∫•t</h3>
                                    <p class="text-sm text-green-600 mt-1">C√°c v·∫≠t t∆∞ ƒë√£ ƒë∆∞·ª£c xu·∫•t th√†nh c√¥ng t·ª´ kho</p>
                                </div>
                                <span class="bg-green-200 text-green-800 px-3 py-1 rounded-full text-sm font-medium"
                                    id="exportedCountBadge">0 v·∫≠t t∆∞</span>
                            </div>
                            <div class="overflow-x-auto" style="max-height: 400px;">
                                <table class="w-full">
                                    <thead class="bg-gray-50 sticky top-0 z-10">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                                T√äN
                                                V·∫¨T T∆Ø</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                                LO·∫†I
                                            </th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                                S·ªê
                                                L∆Ø·ª¢NG XU·∫§T</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                                ƒê∆†N
                                                GI√Å</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                                TH√ÄNH TI·ªÄN</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                                T·ªíN
                                                KHO TR∆Ø·ªöC</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                                T·ªíN
                                                KHO C√íN L·∫†I</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                                NG√ÄY
                                                XU·∫§T</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                                GHI
                                                CH√ö</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200" id="exportedMaterialsForProject">
                                        <tr>
                                            <td colspan="7" class="px-4 py-8 text-center text-gray-500">
                                                ƒêang t·∫£i d·ªØ li·ªáu...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- B·∫£ng 2: V·∫≠t t∆∞ ch∆∞a xu·∫•t -->
                        <div class="bg-white rounded-xl shadow overflow-hidden">
                            <div class="p-4 bg-orange-50 border-b border-orange-200 flex justify-between items-center">
                                <div>
                                    <h3 class="text-lg font-semibold text-orange-800">‚ö†Ô∏è V·∫≠t t∆∞ ch∆∞a xu·∫•t</h3>
                                    <p class="text-sm text-orange-600 mt-1">C√°c v·∫≠t t∆∞ ch∆∞a th·ªÉ xu·∫•t v√¨ thi·∫øu kho - c·∫ßn
                                        b·ªï sung</p>
                                </div>
                                <span class="bg-orange-200 text-orange-800 px-3 py-1 rounded-full text-sm font-medium"
                                    id="unexportedCountBadge">0 v·∫≠t t∆∞</span>
                            </div>
                            <div class="overflow-x-auto" style="max-height: 400px;">
                                <table class="w-full">
                                    <thead class="bg-gray-50 sticky top-0 z-10">
                                        <tr>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                                T√äN
                                                V·∫¨T T∆Ø</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                                LO·∫†I
                                            </th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                                C·∫¶N
                                            </th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                                T·ªíN
                                                KHO</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                                THI·∫æU</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                                TR·∫†NG TH√ÅI</th>
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">
                                                GHI
                                                CH√ö</th>
                                        </tr>
                                    </thead>
                                    <tbody class="divide-y divide-gray-200" id="insufficientMaterialsForProject">
                                        <tr>
                                            <td colspan="7" class="px-4 py-8 text-center text-gray-500">
                                                ƒêang t·∫£i d·ªØ li·ªáu...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LOADING -->
                <div id="loadingIndicator" class="text-center py-8">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
                    <p class="mt-2 text-gray-600">ƒêang t·∫£i d·ªØ li·ªáu...</p>
                </div>

                <!-- NO DATA -->
                <div id="noDataMessage" class="hidden text-center py-12 bg-white rounded-xl shadow">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                        class="w-16 h-16 text-gray-400 mx-auto mb-4">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                    </svg>
                    <p class="text-gray-600 text-lg">Ch∆∞a c√≥ d·ª± √°n n√†o ƒë√£ xu·∫•t v·∫≠t t∆∞</p>
                </div>
            </div> <!-- End p-6 content wrapper -->

            <script>
                const API_BASE = 'http://localhost:3001/api';

                // ========================================
                // GLOBAL VARIABLES cho Phi·∫øu xu·∫•t kho
                // ========================================
                let selectedProject = null;          // D·ª± √°n ƒëang xem
                let exportedMaterialsList = [];      // Danh s√°ch v·∫≠t t∆∞ ƒë√£ xu·∫•t
                let allProjects = [];                // T·∫•t c·∫£ d·ª± √°n

                /**
                 * Format ng√†y xu·∫•t theo ƒë·ªãnh d·∫°ng Vi·ªát Nam: DD/MM/YYYY HH:MM
                 */
                function formatExportDateTime(dateStr) {
                    if (!dateStr) return '-';
                    try {
                        const d = new Date(dateStr);
                        if (isNaN(d.getTime())) return '-';
                        const day = String(d.getDate()).padStart(2, '0');
                        const month = String(d.getMonth() + 1).padStart(2, '0');
                        const year = d.getFullYear();
                        const hours = String(d.getHours()).padStart(2, '0');
                        const minutes = String(d.getMinutes()).padStart(2, '0');
                        return `${day}/${month}/${year} ${hours}:${minutes}`;
                    } catch (e) {
                        return '-';
                    }
                }

                // Load sidebar user info
                async function loadSidebarUserInfo() {
                    try {
                        const token = localStorage.getItem('token');
                        if (!token) {
                            return;
                        }

                        const response = await fetch(`${API_BASE}/auth/me`, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        // X·ª≠ l√Ω l·ªói HTTP status
                        if (!response.ok) {
                            if (response.status === 401 || response.status === 403) {
                                // Token kh√¥ng h·ª£p l·ªá ho·∫∑c h·∫øt h·∫°n - x√≥a token v√† kh√¥ng hi·ªÉn th·ªã l·ªói
                                localStorage.removeItem('token');
                                localStorage.removeItem('user');
                                return;
                            }
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const result = await response.json();

                        if (result.success) {
                            const user = result.data;
                            const userNameEl = document.getElementById('sidebarUserName');
                            if (userNameEl) {
                                userNameEl.textContent = user.full_name || 'User';
                            }

                            const avatarInitial = document.getElementById('sidebarUserAvatarInitial');
                            const avatarImage = document.getElementById('sidebarUserAvatarImage');

                            if (avatarInitial && avatarImage) {
                                if (user.avatar_url) {
                                    avatarImage.src = user.avatar_url;
                                    avatarImage.classList.remove('hidden');
                                    avatarInitial.classList.add('hidden');
                                } else {
                                    const initial = (user.full_name || 'U').charAt(0).toUpperCase();
                                    avatarInitial.textContent = initial;
                                    avatarInitial.classList.remove('hidden');
                                    avatarImage.classList.add('hidden');
                                }
                            }
                        }
                    } catch (error) {
                        // Ch·ªâ log l·ªói, kh√¥ng hi·ªÉn th·ªã alert ƒë·ªÉ tr√°nh l√†m phi·ªÅn ng∆∞·ªùi d√πng
                        console.warn('L·ªói load sidebar user info (c√≥ th·ªÉ do token h·∫øt h·∫°n):', error.message);
                    }
                }

                // Toggle sidebar user menu
                function toggleSidebarUserMenu() {
                    const dropdown = document.getElementById('sidebarUserMenuDropdown');
                    if (dropdown) {
                        dropdown.classList.toggle('hidden');
                    }
                }

                // Load header user info
                async function loadHeaderUserInfo() {
                    try {
                        const token = localStorage.getItem('token');
                        if (!token) {
                            return;
                        }

                        const response = await fetch(`${API_BASE}/auth/me`, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });

                        // X·ª≠ l√Ω l·ªói HTTP status
                        if (!response.ok) {
                            if (response.status === 401 || response.status === 403) {
                                // Token kh√¥ng h·ª£p l·ªá ho·∫∑c h·∫øt h·∫°n - x√≥a token v√† kh√¥ng hi·ªÉn th·ªã l·ªói
                                localStorage.removeItem('token');
                                localStorage.removeItem('user');
                                return;
                            }
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const result = await response.json();

                        if (result.success) {
                            const user = result.data;
                            const avatarInitial = document.getElementById('headerUserAvatarInitial');
                            const avatarImage = document.getElementById('headerUserAvatarImage');

                            if (avatarInitial && avatarImage) {
                                if (user.avatar_url) {
                                    avatarImage.src = user.avatar_url;
                                    avatarImage.classList.remove('hidden');
                                    avatarInitial.classList.add('hidden');
                                } else {
                                    const initial = (user.full_name || 'U').charAt(0).toUpperCase();
                                    avatarInitial.textContent = initial;
                                    avatarInitial.classList.remove('hidden');
                                    avatarImage.classList.add('hidden');
                                }
                            }
                        }
                    } catch (error) {
                        console.error('L·ªói load header user info:', error);
                    }
                }

                // Toggle header user menu
                function toggleHeaderUserMenu() {
                    const dropdown = document.getElementById('userMenuDropdown');
                    if (dropdown) {
                        dropdown.classList.toggle('hidden');
                    }
                }

                // Handle logout (shared function)
                function handleLogout() {
                    if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
                        localStorage.removeItem('token');
                        localStorage.removeItem('user');
                        window.location.href = 'login.html';
                    }
                }

                // Close dropdowns when clicking outside
                document.addEventListener('click', function (event) {
                    // Sidebar dropdown
                    const sidebarDropdown = document.getElementById('sidebarUserMenuDropdown');
                    const sidebarButton = event.target.closest('[onclick="toggleSidebarUserMenu()"]');
                    if (sidebarDropdown && !sidebarButton && !sidebarDropdown.contains(event.target)) {
                        sidebarDropdown.classList.add('hidden');
                    }

                    // Header dropdown
                    const headerDropdown = document.getElementById('userMenuDropdown');
                    const headerButton = event.target.closest('[onclick="toggleHeaderUserMenu()"]');
                    if (headerDropdown && !headerButton && !headerDropdown.contains(event.target)) {
                        headerDropdown.classList.add('hidden');
                    }
                });

                // Load company logo and name
                async function loadCompanyLogo() {
                    try {
                        const response = await fetch(`${API_BASE}/company-settings`);
                        const result = await response.json();

                        if (result.success && result.data) {
                            // Load logo
                            if (result.data.logo_path) {
                                const logoImg = document.getElementById('companyLogo');
                                const logoIcon = document.getElementById('companyLogoIcon');
                                if (logoImg && logoIcon) {
                                    logoImg.src = result.data.logo_path;
                                    logoImg.classList.remove('hidden');
                                    logoIcon.classList.add('hidden');
                                }
                            }

                            // Load company name
                            const companyNameEl = document.getElementById('companyName');
                            if (companyNameEl && result.data.company_name) {
                                companyNameEl.textContent = result.data.company_name;
                            }
                        }
                    } catch (error) {
                        console.error('L·ªói load logo:', error);
                    }
                }

                // Check authentication
                function checkAuth() {
                    const token = localStorage.getItem('token');
                    if (!token) {
                        window.location.href = 'login.html';
                        return false;
                    }
                    return true;
                }

                // allProjects moved to global scope
                let allMaterials = [];

                // Load exported materials
                async function loadExportedMaterials() {
                    try {
                        document.getElementById('loadingIndicator').classList.remove('hidden');
                        document.getElementById('noDataMessage').classList.add('hidden');

                        const response = await fetch(`${API_BASE}/project-materials/exported`);
                        const result = await response.json();

                        if (result.success) {
                            allProjects = result.data.projects || [];
                            allMaterials = result.data.materials || [];

                            updateSummary();
                            displayProjects(allProjects);
                        } else {
                            console.error('Error loading exported materials:', result.message);
                            document.getElementById('noDataMessage').classList.remove('hidden');
                        }
                    } catch (error) {
                        console.error('Error loading exported materials:', error);
                        document.getElementById('noDataMessage').classList.remove('hidden');
                    } finally {
                        document.getElementById('loadingIndicator').classList.add('hidden');
                    }
                }

                // Update summary cards (ƒê√£ lo·∫°i b·ªè - gi·ªØ h√†m r·ªóng ƒë·ªÉ tr√°nh l·ªói n·∫øu ƒë∆∞·ª£c g·ªçi ·ªü ƒë√¢u ƒë√≥)
                function updateSummary() {
                    // C√°c summary cards ƒë√£ ƒë∆∞·ª£c lo·∫°i b·ªè theo y√™u c·∫ßu thi·∫øt k·∫ø m·ªõi
                    // Th·ªëng k√™ gi·ªù ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü m·ª©c ƒë·ªô chi ti·∫øt d·ª± √°n
                    // Gi·ªØ h√†m r·ªóng ƒë·ªÉ tr√°nh l·ªói n·∫øu ƒë∆∞·ª£c g·ªçi ·ªü n∆°i kh√°c
                    console.log('updateSummary called - summary cards have been removed');
                }

                // Display projects
                function displayProjects(projects) {
                    const container = document.getElementById('exportedProjectsList');

                    if (projects.length === 0) {
                        container.innerHTML = '';
                        document.getElementById('noDataMessage').classList.remove('hidden');
                        return;
                    }

                    document.getElementById('noDataMessage').classList.add('hidden');

                    container.innerHTML = projects.map(project => {
                        // S·ª≠ d·ª•ng total_cost t·ª´ API thay v√¨ t√≠nh l·∫°i t·ª´ allMaterials
                        const projectTotalCost = project.total_cost || 0;
                        const materialsCount = project.materials_count || 0;
                        const statusColor = project.status === 'completed' ? 'bg-green-100 text-green-800' : 'bg-orange-100 text-orange-800';
                        const statusText = project.status === 'completed' ? 'ƒê√£ ho√†n th√†nh' : 'ƒêang s·∫£n xu·∫•t';

                        return `
                    <div class="project-card bg-white rounded-xl shadow p-6 fade-in" data-project-id="${project.id}">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <h3 class="text-xl font-bold text-gray-800">${project.project_code || 'N/A'} - ${project.project_name || 'N/A'}</h3>
                                    <span class="px-3 py-1 rounded-full text-xs font-semibold ${statusColor}">${statusText}</span>
                                </div>
                                <p class="text-gray-600 mb-1">Kh√°ch h√†ng: ${project.customer_name || 'N/A'}</p>
                                <p class="text-sm text-gray-500">Ti·∫øn ƒë·ªô: ${project.progress_percent || 0}%</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-gray-600 mb-1">T·ªïng gi√° tr·ªã v·∫≠t t∆∞</p>
                                <p class="text-2xl font-bold text-indigo-600">${formatCurrency(projectTotalCost)}</p>
                                <p class="text-xs text-gray-500 mt-1">${materialsCount} v·∫≠t t∆∞</p>
                            </div>
                        </div>

                        <div class="border-t border-gray-200 pt-4">
                            <div class="flex justify-between items-center mb-3">
                                <h4 class="font-semibold text-gray-700">Danh s√°ch v·∫≠t t∆∞</h4>
                                <button onclick="viewProjectMaterials(${project.id})" 
                                    class="text-indigo-600 hover:text-indigo-800 text-sm font-medium flex items-center gap-1">
                                    <span>Xem chi ti·∫øt v·∫≠t t∆∞</span>
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-4 h-4">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <div class="border-t border-gray-200 pt-4 mt-4 flex justify-end gap-3">
                            <a href="production.html?project_id=${project.id}" 
                                class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium hover:bg-indigo-700 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-4 h-4">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                </svg>
                                Kho v·∫≠t t∆∞
                            </a>
                        </div>
                    </div>
                `;
                    }).join('');
                }

                // Xem chi ti·∫øt v·∫≠t t∆∞ c·ªßa d·ª± √°n (2 c·ªôt: ƒë√£ xu·∫•t | ch∆∞a xu·∫•t)
                async function viewProjectMaterials(projectId) {
                    try {
                        // ·∫®n danh s√°ch d·ª± √°n, hi·ªÉn th·ªã ph·∫ßn chi ti·∫øt v·∫≠t t∆∞
                        document.getElementById('exportedProjectsList').classList.add('hidden');
                        document.getElementById('projectMaterialsDetail').classList.remove('hidden');

                        // Load d·ªØ li·ªáu v·∫≠t t∆∞ t·ª´ API
                        const response = await fetch(`${API_BASE}/project-materials/${projectId}`);
                        const result = await response.json();

                        console.log('API Response:', result); // Debug log

                        if (result.success) {
                            // Backend tr·∫£ v·ªÅ exported v√† insufficient ·ªü root level, kh√¥ng ph·∫£i trong data
                            const exported = result.exported || result.data?.exported || [];
                            const insufficient = result.insufficient || result.data?.insufficient || [];

                            console.log('Exported materials:', exported.length, exported);
                            console.log('Insufficient materials:', insufficient.length, insufficient);

                            // L∆∞u v√†o global variable ƒë·ªÉ d√πng cho Phi·∫øu xu·∫•t kho
                            exportedMaterialsList = exported;

                            // Hi·ªÉn th·ªã th√¥ng tin d·ª± √°n
                            const project = allProjects.find(p => p.id === projectId);
                            if (project) {
                                selectedProject = project;  // L∆∞u v√†o global variable
                                document.getElementById('detailProjectName').textContent = `${project.project_code || 'N/A'} - ${project.project_name || 'N/A'}`;
                                document.getElementById('detailProjectCustomer').textContent = `Kh√°ch h√†ng: ${project.customer_name || 'N/A'}`;
                            }

                            // Render 2 c·ªôt (gi·ªù l√† 2 b·∫£ng d·ªçc)
                            displayExportedMaterialsForProject(exported);
                            displayInsufficientMaterialsForProject(insufficient);

                            // C·∫¨P NH·∫¨T TH·ªêNG K√ä V·∫¨T T∆Ø THEO LO·∫†I (M·ªõi th√™m)
                            updateMaterialStatistics(exported, insufficient);
                        } else {
                            console.error('API Error:', result);
                            alert('L·ªói khi t·∫£i d·ªØ li·ªáu v·∫≠t t∆∞: ' + (result.message || 'Unknown error'));
                        }
                    } catch (error) {
                        console.error('Error loading project materials:', error);
                        alert('L·ªói khi t·∫£i d·ªØ li·ªáu v·∫≠t t∆∞: ' + error.message);
                    }
                }

                /**
                 * C·∫¨P NH·∫¨T TH·ªêNG K√ä V·∫¨T T∆Ø THEO LO·∫†I
                 * T√≠nh to√°n v√† hi·ªÉn th·ªã th·ªëng k√™ chi ti·∫øt khi xem d·ª± √°n
                 * @param {Array} exported - Danh s√°ch v·∫≠t t∆∞ ƒë√£ xu·∫•t
                 * @param {Array} insufficient - Danh s√°ch v·∫≠t t∆∞ ch∆∞a xu·∫•t (thi·∫øu)
                 */
                function updateMaterialStatistics(exported, insufficient) {
                    // ƒê·∫øm theo lo·∫°i v·∫≠t t∆∞
                    const stats = {
                        aluminum: { exported: 0, unexported: 0 },
                        glass: { exported: 0, unexported: 0 },
                        accessory: { exported: 0, unexported: 0 },
                        other: { exported: 0, unexported: 0 }
                    };

                    // T√≠nh t·ªïng gi√° tr·ªã ƒë√£ xu·∫•t
                    let totalExportedValue = 0;

                    // ƒê·∫øm v·∫≠t t∆∞ ƒë√£ xu·∫•t theo lo·∫°i
                    exported.forEach(mat => {
                        const type = mat.material_type || 'other';
                        if (stats[type]) {
                            stats[type].exported++;
                        } else {
                            stats.other.exported++;
                        }
                        // C·ªông gi√° tr·ªã
                        totalExportedValue += parseFloat(mat.total_cost || 0);
                    });

                    // ƒê·∫øm v·∫≠t t∆∞ ch∆∞a xu·∫•t theo lo·∫°i
                    insufficient.forEach(mat => {
                        const type = mat.material_type || 'other';
                        if (stats[type]) {
                            stats[type].unexported++;
                        } else {
                            stats.other.unexported++;
                        }
                    });

                    // T·ªïng s·ªë v·∫≠t t∆∞
                    const totalExported = exported.length;
                    const totalUnexported = insufficient.length;
                    const grandTotal = totalExported + totalUnexported;
                    const completionRate = grandTotal > 0 ? Math.round((totalExported / grandTotal) * 100) : 0;

                    // C·∫≠p nh·∫≠t c√°c th·ªëng k√™ t·ªïng quan
                    const statExportedEl = document.getElementById('statExportedTotal');
                    const statUnexportedEl = document.getElementById('statUnexportedTotal');
                    const statValueEl = document.getElementById('statExportedValue');
                    const statRateEl = document.getElementById('statCompletionRate');

                    if (statExportedEl) statExportedEl.textContent = totalExported;
                    if (statUnexportedEl) statUnexportedEl.textContent = totalUnexported;
                    if (statValueEl) statValueEl.textContent = formatCurrency(totalExportedValue);
                    if (statRateEl) statRateEl.textContent = completionRate + '%';

                    // C·∫≠p nh·∫≠t th·ªëng k√™ theo lo·∫°i: Nh√¥m
                    const aluminumExportedEl = document.getElementById('statAluminumExported');
                    const aluminumUnexportedEl = document.getElementById('statAluminumUnexported');
                    if (aluminumExportedEl) aluminumExportedEl.textContent = stats.aluminum.exported;
                    if (aluminumUnexportedEl) aluminumUnexportedEl.textContent = stats.aluminum.unexported;

                    // C·∫≠p nh·∫≠t th·ªëng k√™ theo lo·∫°i: K√≠nh
                    const glassExportedEl = document.getElementById('statGlassExported');
                    const glassUnexportedEl = document.getElementById('statGlassUnexported');
                    if (glassExportedEl) glassExportedEl.textContent = stats.glass.exported;
                    if (glassUnexportedEl) glassUnexportedEl.textContent = stats.glass.unexported;

                    // C·∫≠p nh·∫≠t th·ªëng k√™ theo lo·∫°i: Ph·ª• ki·ªán
                    const accessoryExportedEl = document.getElementById('statAccessoryExported');
                    const accessoryUnexportedEl = document.getElementById('statAccessoryUnexported');
                    if (accessoryExportedEl) accessoryExportedEl.textContent = stats.accessory.exported;
                    if (accessoryUnexportedEl) accessoryUnexportedEl.textContent = stats.accessory.unexported;

                    // C·∫≠p nh·∫≠t th·ªëng k√™ theo lo·∫°i: V·∫≠t t∆∞ ph·ª•
                    const otherExportedEl = document.getElementById('statOtherExported');
                    const otherUnexportedEl = document.getElementById('statOtherUnexported');
                    if (otherExportedEl) otherExportedEl.textContent = stats.other.exported;
                    if (otherUnexportedEl) otherUnexportedEl.textContent = stats.other.unexported;

                    // C·∫≠p nh·∫≠t badge ƒë·∫øm s·ªë l∆∞·ª£ng
                    const exportedBadgeEl = document.getElementById('exportedCountBadge');
                    const unexportedBadgeEl = document.getElementById('unexportedCountBadge');
                    if (exportedBadgeEl) exportedBadgeEl.textContent = `${totalExported} v·∫≠t t∆∞`;
                    if (unexportedBadgeEl) unexportedBadgeEl.textContent = `${totalUnexported} v·∫≠t t∆∞`;

                    console.log('üìä Material Statistics Updated:', {
                        totalExported,
                        totalUnexported,
                        totalExportedValue,
                        completionRate: completionRate + '%',
                        byType: stats
                    });
                }

                // Hi·ªÉn th·ªã v·∫≠t t∆∞ ƒë√£ xu·∫•t
                function displayExportedMaterialsForProject(materials) {
                    const container = document.getElementById('exportedMaterialsForProject');
                    if (!container) return;

                    if (materials.length === 0) {
                        container.innerHTML = `
                                <tr>
                                    <td colspan="8" class="px-4 py-8 text-center text-gray-500">
                                        Kh√¥ng c√≥ v·∫≠t t∆∞ ƒë√£ xu·∫•t
                                    </td>
                                </tr>`;
                        return;
                    }

                    container.innerHTML = materials.map(mat => {
                        const typeName = getTypeName(mat.material_type);
                        const typeColor = getTypeColor(mat.material_type);
                        const quantity = parseFloat(mat.quantity || 0); // S·ªë l∆∞·ª£ng ƒë√£ xu·∫•t
                        const currentStock = parseFloat(mat.available_stock || 0); // T·ªìn kho hi·ªán t·∫°i (sau khi xu·∫•t)
                        const stockBeforeExport = currentStock + quantity; // T·ªìn kho tr∆∞·ªõc khi xu·∫•t
                        const remainingStock = currentStock; // T·ªìn kho c√≤n l·∫°i = t·ªìn kho hi·ªán t·∫°i
                        const unit = mat.unit || 'c√°i';

                        // M√†u s·∫Øc cho t·ªìn kho c√≤n l·∫°i: xanh n·∫øu > 0, v√†ng n·∫øu = 0, ƒë·ªè n·∫øu < 0
                        let remainingStockColor = 'text-green-600';
                        let remainingStockBadge = '';
                        if (remainingStock < 0) {
                            remainingStockColor = 'text-red-600 font-bold';
                            remainingStockBadge = '<span class="text-xs text-red-500 ml-1">(√Çm)</span>';
                        } else if (remainingStock === 0) {
                            remainingStockColor = 'text-orange-600 font-semibold';
                            remainingStockBadge = '<span class="text-xs text-orange-500 ml-1">(H·∫øt)</span>';
                        } else if (remainingStock < quantity) {
                            remainingStockColor = 'text-yellow-600 font-semibold';
                            remainingStockBadge = '<span class="text-xs text-yellow-500 ml-1">(Th·∫•p)</span>';
                        }

                        // Format ng√†y xu·∫•t
                        const exportDateStr = mat.created_at ? formatExportDateTime(mat.created_at) : '-';

                        return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 font-medium">${escapeHtml(mat.material_name || 'N/A')}</td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 text-xs rounded ${typeColor}">${typeName}</span>
                        </td>
                        <td class="px-4 py-3 font-semibold text-indigo-600">${quantity.toFixed(2)} ${unit}</td>
                        <td class="px-4 py-3">${formatCurrency(mat.unit_price || 0)}</td>
                        <td class="px-4 py-3 font-medium text-green-600">${formatCurrency(mat.total_cost || 0)}</td>
                        <td class="px-4 py-3 text-gray-600 font-medium">${stockBeforeExport.toFixed(2)} ${unit}</td>
                        <td class="px-4 py-3 ${remainingStockColor} font-semibold">
                            ${remainingStock.toFixed(2)} ${unit}
                            ${remainingStockBadge}
                        </td>
                        <td class="px-4 py-3 text-gray-500 text-sm whitespace-nowrap">${exportDateStr}</td>
                        <td class="px-4 py-3 text-gray-500 text-sm">${escapeHtml(mat.notes || '') || '-'}</td>
                    </tr>`;
                    }).join('');
                }

                // Hi·ªÉn th·ªã v·∫≠t t∆∞ ch∆∞a xu·∫•t
                function displayInsufficientMaterialsForProject(materials) {
                    const container = document.getElementById('insufficientMaterialsForProject');
                    if (!container) return;

                    if (materials.length === 0) {
                        container.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-4 py-8 text-center text-gray-500">
                            Kh√¥ng c√≥ v·∫≠t t∆∞ ch∆∞a xu·∫•t
                        </td>
                    </tr>`;
                        return;
                    }

                    const getStockStatusBadge = (status) => {
                        const badges = {
                            'not_found': '<span class="px-2 py-1 text-xs rounded bg-gray-100 text-gray-700">‚äò Kh√¥ng c√≥ trong kho</span>',
                            'shortage': '<span class="px-2 py-1 text-xs rounded bg-red-100 text-red-700">‚úó H·∫øt kho</span>',
                            'partial': '<span class="px-2 py-1 text-xs rounded bg-yellow-100 text-yellow-700">‚ö† Thi·∫øu m·ªôt ph·∫ßn</span>'
                        };
                        return badges[status] || '<span class="px-2 py-1 text-xs rounded bg-gray-100 text-gray-700">-</span>';
                    };

                    container.innerHTML = materials.map(mat => {
                        const typeName = getTypeName(mat.material_type);
                        const typeColor = getTypeColor(mat.material_type);
                        const requiredQty = parseFloat(mat.quantity) || 0;
                        const availableStock = parseFloat(mat.available_stock) || 0;
                        const shortage = parseFloat(mat.shortage) || 0;
                        const stockStatus = mat.stock_status || 'unknown';
                        const stockNote = mat.stock_note || '';

                        return `
                    <tr class="hover:bg-gray-50 ${stockStatus === 'not_found' ? 'bg-gray-50' : ''}">
                        <td class="px-4 py-3 font-medium">${escapeHtml(mat.material_name || 'N/A')}</td>
                        <td class="px-4 py-3">
                            <span class="px-2 py-1 text-xs rounded ${typeColor}">${typeName}</span>
                        </td>
                        <td class="px-4 py-3">${requiredQty.toFixed(2)} ${mat.unit || 'c√°i'}</td>
                        <td class="px-4 py-3">${stockStatus === 'not_found' ? '-' : availableStock.toFixed(2)} ${stockStatus === 'not_found' ? '' : mat.unit || 'c√°i'}</td>
                        <td class="px-4 py-3 text-red-600 font-semibold">${shortage > 0 ? shortage.toFixed(2) + ' ' + (mat.unit || 'c√°i') : '-'}</td>
                        <td class="px-4 py-3">${getStockStatusBadge(stockStatus)}</td>
                        <td class="px-4 py-3 text-gray-500 text-sm">${escapeHtml(stockNote) || '-'}</td>
                    </tr>`;
                    }).join('');
                }

                // Quay l·∫°i danh s√°ch d·ª± √°n
                function backToProjectsList() {
                    document.getElementById('exportedProjectsList').classList.remove('hidden');
                    document.getElementById('projectMaterialsDetail').classList.add('hidden');
                }

                // Escape HTML helper
                function escapeHtml(text) {
                    if (!text) return '';
                    const div = document.createElement('div');
                    div.textContent = String(text);
                    return div.innerHTML;
                }

                // Filter projects
                function filterProjects() {
                    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                    const statusFilter = document.getElementById('statusFilter').value;

                    let filtered = allProjects.filter(project => {
                        const matchesSearch =
                            (project.project_code || '').toLowerCase().includes(searchTerm) ||
                            (project.project_name || '').toLowerCase().includes(searchTerm) ||
                            (project.customer_name || '').toLowerCase().includes(searchTerm);

                        const matchesStatus = statusFilter === 'all' || project.status === statusFilter;

                        return matchesSearch && matchesStatus;
                    });

                    displayProjects(filtered);
                }

                // Helper functions
                function getTypeName(type) {
                    const names = {
                        'accessory': 'Ph·ª• ki·ªán',
                        'aluminum': 'H·ªá nh√¥m',
                        'glass': 'K√≠nh',
                        'other': 'Kh√°c'
                    };
                    return names[type] || type || 'Kh√°c';
                }

                function getTypeColor(type) {
                    const colors = {
                        'accessory': 'bg-blue-100 text-blue-700',
                        'aluminum': 'bg-green-100 text-green-700',
                        'glass': 'bg-purple-100 text-purple-700',
                        'other': 'bg-gray-100 text-gray-700'
                    };
                    return colors[type] || 'bg-gray-100 text-gray-700';
                }

                function formatCurrency(amount) {
                    if (!amount) return '0 ‚Ç´';
                    return new Intl.NumberFormat('vi-VN', {
                        style: 'currency',
                        currency: 'VND'
                    }).format(amount);
                }

                function formatNumber(num) {
                    if (!num) return '0';
                    return new Intl.NumberFormat('vi-VN').format(num);
                }

                // Toggle notifications dropdown
                function toggleNotifications() {
                    const dropdown = document.getElementById('notificationsDropdown');
                    if (dropdown) {
                        dropdown.classList.toggle('hidden');
                    }
                }

                // ========== XU·∫§T V·∫¨T T∆Ø CHO D·ª∞ √ÅN ==========
                let selectedProjectId = null;
                let allExportedMaterials = [];
                let allInventoryDataForExport = [];
                let inventoryDataForExport = [];
                let currentMaterialTypeInModal = 'accessory';
                let allProjectsForExport = []; // L∆∞u danh s√°ch d·ª± √°n ƒë·ªÉ filter (tr√°nh conflict v·ªõi allProjects ·ªü tr√™n)

                // Load danh s√°ch d·ª± √°n d·∫°ng card
                async function loadProjectsForExport() {
                    try {
                        const response = await fetch(`${API_BASE}/project-materials/projects/bom-extraction`);
                        const result = await response.json();
                        const projectsList = document.getElementById('projectsList');

                        if (projectsList && result.success && result.data) {
                            allProjectsForExport = result.data || [];

                            if (allProjectsForExport.length === 0) {
                                projectsList.innerHTML = `
                            <div class="col-span-full text-center py-8 text-gray-500">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-12 h-12 mx-auto mb-2 opacity-50">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                <p>Ch∆∞a c√≥ d·ª± √°n n√†o</p>
                            </div>`;
                                return;
                            }

                            renderProjectsList(allProjectsForExport);
                        }
                    } catch (error) {
                        console.error('L·ªói load d·ª± √°n:', error);
                        const projectsList = document.getElementById('projectsList');
                        if (projectsList) {
                            projectsList.innerHTML = `
                        <div class="col-span-full text-center py-8 text-red-500">
                            <p>L·ªói khi t·∫£i danh s√°ch d·ª± √°n: ${error.message}</p>
                        </div>`;
                        }
                    }
                }

                // Render danh s√°ch d·ª± √°n d·∫°ng card
                function renderProjectsList(projects) {
                    const projectsList = document.getElementById('projectsList');
                    if (!projectsList) return;

                    if (projects.length === 0) {
                        projectsList.innerHTML = `
                    <div class="col-span-full text-center py-8 text-gray-500">
                        <p>Kh√¥ng t√¨m th·∫•y d·ª± √°n n√†o</p>
                    </div>`;
                        return;
                    }

                    projectsList.innerHTML = projects.map(project => {
                        const projectCode = project.project_code || 'N/A';
                        const projectName = project.project_name || 'N/A';
                        const customerName = project.customer_name || 'N/A';
                        const status = project.status || 'draft';
                        const progress = project.progress || 0;

                        // M√†u s·∫Øc theo tr·∫°ng th√°i
                        let statusColor = 'bg-gray-100 text-gray-700';
                        let statusText = 'Nh√°p';
                        if (status === 'in_progress') {
                            statusColor = 'bg-blue-100 text-blue-700';
                            statusText = 'ƒêang th·ª±c hi·ªán';
                        } else if (status === 'completed') {
                            statusColor = 'bg-green-100 text-green-700';
                            statusText = 'Ho√†n th√†nh';
                        }

                        return `
                    <div class="project-card bg-white border-2 border-gray-200 rounded-xl p-8 hover:shadow-xl cursor-pointer transition-all hover:border-indigo-400"
                         onclick="selectProject(${project.id}, '${escapeHtml(projectCode)}', '${escapeHtml(projectName)}', '${escapeHtml(customerName)}')">
                        <div class="flex justify-between items-start mb-5">
                            <div class="flex-1">
                                <h3 class="font-bold text-2xl text-gray-800 mb-2">${escapeHtml(projectCode)}</h3>
                                <p class="text-base text-gray-600 mb-3">${escapeHtml(projectName)}</p>
                            </div>
                            <span class="px-3 py-1.5 text-sm font-semibold rounded-full ${statusColor}">${statusText}</span>
                        </div>
                        <div class="space-y-3 mb-5">
                            <div class="flex items-center text-base text-gray-700">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-5 h-5 mr-3 text-indigo-600">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                </svg>
                                <span class="font-medium">${escapeHtml(customerName)}</span>
                            </div>
                            <div class="flex items-center text-base text-gray-700">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-5 h-5 mr-3 text-indigo-600">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                </svg>
                                <span class="font-medium">Ti·∫øn ƒë·ªô: <span class="text-indigo-600 font-bold">${progress}%</span></span>
                            </div>
                        </div>
                        <div class="mt-6 pt-5 border-t-2 border-gray-200">
                            <div class="flex items-center justify-between">
                                <span class="text-sm font-medium text-gray-600">Nh·∫•n ƒë·ªÉ xem v·∫≠t t∆∞</span>
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6 text-indigo-600">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                </svg>
                            </div>
                        </div>
                    </div>
                `;
                    }).join('');
                }

                // Escape HTML helper
                function escapeHtml(text) {
                    if (!text) return '';
                    const div = document.createElement('div');
                    div.textContent = String(text);
                    return div.innerHTML;
                }

                // Ch·ªçn d·ª± √°n
                function selectProject(projectId, projectCode, projectName, customerName) {
                    selectedProjectId = projectId;

                    // ·∫®n danh s√°ch d·ª± √°n, hi·ªÉn th·ªã ph·∫ßn xu·∫•t v·∫≠t t∆∞
                    document.getElementById('projectListSection').classList.add('hidden');
                    document.getElementById('exportMaterialsSection').classList.remove('hidden');

                    // C·∫≠p nh·∫≠t th√¥ng tin d·ª± √°n
                    document.getElementById('selectedProjectName').textContent = `${projectCode} - ${projectName}`;
                    document.getElementById('selectedProjectCustomer').textContent = `Kh√°ch h√†ng: ${customerName}`;

                    // Load v·∫≠t t∆∞ c·ªßa d·ª± √°n
                    loadProjectMaterials();
                }

                // Quay l·∫°i danh s√°ch d·ª± √°n
                function backToProjectList() {
                    selectedProjectId = null;
                    document.getElementById('projectListSection').classList.remove('hidden');
                    document.getElementById('exportMaterialsSection').classList.add('hidden');
                }

                // Filter danh s√°ch d·ª± √°n
                function filterProjects() {
                    const searchTerm = document.getElementById('projectSearchInput').value.toLowerCase();
                    if (!searchTerm) {
                        renderProjectsList(allProjectsForExport);
                        return;
                    }

                    const filtered = allProjectsForExport.filter(project => {
                        const code = (project.project_code || '').toLowerCase();
                        const name = (project.project_name || '').toLowerCase();
                        const customer = (project.customer_name || '').toLowerCase();
                        return code.includes(searchTerm) || name.includes(searchTerm) || customer.includes(searchTerm);
                    });

                    renderProjectsList(filtered);
                }

                // Load v·∫≠t t∆∞ c·ªßa d·ª± √°n ƒë√£ ch·ªçn
                async function loadProjectMaterials() {
                    if (!selectedProjectId) {
                        const btnAdd = document.getElementById('btnAddMaterial');
                        const btnConfirmExport = document.getElementById('btnConfirmExport');

                        if (btnAdd) btnAdd.disabled = true;
                        if (btnConfirmExport) btnConfirmExport.disabled = true;

                        document.getElementById('exportedCount').textContent = '0';
                        document.getElementById('insufficientCount').textContent = '0';
                        document.getElementById('exportedMaterialsTable').innerHTML = `
                    <tr>
                        <td colspan="8" class="px-4 py-8 text-center text-gray-500">
                            Ch·ªçn d·ª± √°n ƒë·ªÉ xem v·∫≠t t∆∞ ƒë√£ xu·∫•t
                        </td>
                    </tr>`;
                        document.getElementById('insufficientMaterialsTable').innerHTML = `
                    <tr>
                        <td colspan="8" class="px-4 py-8 text-center text-gray-500">
                            Kh√¥ng c√≥ v·∫≠t t∆∞ ch∆∞a ƒë·ªß
                        </td>
                    </tr>`;

                        // ƒê·∫£m b·∫£o c·∫£ 2 ph·∫ßn ƒë·ªÅu hi·ªÉn th·ªã
                        const exportedSection = document.getElementById('exportedMaterialsSection');
                        const insufficientSection = document.getElementById('insufficientMaterialsSection');
                        if (exportedSection) exportedSection.classList.remove('hidden');
                        if (insufficientSection) insufficientSection.classList.remove('hidden');

                        return;
                    }

                    const btnAdd = document.getElementById('btnAddMaterial');
                    const btnConfirmExport = document.getElementById('btnConfirmExport');

                    if (btnAdd) btnAdd.disabled = false;

                    try {
                        const response = await fetch(`${API_BASE}/project-materials/${selectedProjectId}`);
                        const result = await response.json();

                        if (result.success && result.data && Array.isArray(result.data)) {
                            console.log('üì¶ T·ªïng v·∫≠t t∆∞:', result.data.length);
                            console.log('‚úÖ ƒê√£ xu·∫•t:', result.exported?.length || 0);
                            console.log('‚ö†Ô∏è Ch∆∞a ƒë·ªß:', result.insufficient?.length || 0);

                            allExportedMaterials = result.data || [];

                            document.getElementById('selectedProjectTotalCost').textContent = formatCurrency(result.total_cost || 0);

                            const exportedCount = result.exported_count || (result.exported ? result.exported.length : 0);
                            const insufficientCount = result.insufficient_count || (result.insufficient ? result.insufficient.length : 0);

                            document.getElementById('exportedCount').textContent = exportedCount;
                            document.getElementById('insufficientCount').textContent = insufficientCount;

                            if (btnConfirmExport) {
                                btnConfirmExport.disabled = !result.exported || result.exported.length === 0;
                            }

                            // Hi·ªÉn th·ªã c·∫£ 2 b·∫£ng c√πng l√∫c
                            displayExportedMaterialsTable(result.exported || []);
                            displayInsufficientMaterialsTable(result.insufficient || []);

                            // ƒê·∫£m b·∫£o c·∫£ 2 ph·∫ßn ƒë·ªÅu hi·ªÉn th·ªã
                            const exportedSection = document.getElementById('exportedMaterialsSection');
                            const insufficientSection = document.getElementById('insufficientMaterialsSection');
                            if (exportedSection) exportedSection.classList.remove('hidden');
                            if (insufficientSection) insufficientSection.classList.remove('hidden');
                        } else {
                            allExportedMaterials = [];
                            document.getElementById('exportedCount').textContent = '0';
                            document.getElementById('insufficientCount').textContent = '0';
                            document.getElementById('selectedProjectTotalCost').textContent = '0 ‚Ç´';
                            displayExportedMaterialsTable([]);
                            displayInsufficientMaterialsTable([]);
                            if (btnConfirmExport) btnConfirmExport.disabled = true;

                            // ƒê·∫£m b·∫£o c·∫£ 2 ph·∫ßn ƒë·ªÅu hi·ªÉn th·ªã
                            const exportedSection = document.getElementById('exportedMaterialsSection');
                            const insufficientSection = document.getElementById('insufficientMaterialsSection');
                            if (exportedSection) exportedSection.classList.remove('hidden');
                            if (insufficientSection) insufficientSection.classList.remove('hidden');
                        }
                    } catch (error) {
                        console.error('L·ªói load v·∫≠t t∆∞ d·ª± √°n:', error);
                        allExportedMaterials = [];
                        document.getElementById('exportedCount').textContent = '0';
                        document.getElementById('insufficientCount').textContent = '0';
                        if (btnConfirmExport) btnConfirmExport.disabled = true;
                    }
                }

                // Switch tab gi·ªØa "V·∫≠t t∆∞ ƒë√£ xu·∫•t" v√† "V·∫≠t t∆∞ ch∆∞a ƒë·ªß"
                function switchMaterialListTab(tabName) {
                    const exportedSection = document.getElementById('exportedMaterialsSection');
                    const insufficientSection = document.getElementById('insufficientMaterialsSection');
                    const exportedBtn = document.getElementById('tabExportedBtn');
                    const insufficientBtn = document.getElementById('tabInsufficientBtn');

                    if (tabName === 'exported') {
                        exportedSection.classList.remove('hidden');
                        insufficientSection.classList.add('hidden');
                        exportedBtn.classList.add('border-indigo-500', 'text-indigo-600', 'active');
                        exportedBtn.classList.remove('border-transparent', 'text-gray-500');
                        insufficientBtn.classList.remove('border-indigo-500', 'text-indigo-600', 'active');
                        insufficientBtn.classList.add('border-transparent', 'text-gray-500');
                    } else {
                        exportedSection.classList.add('hidden');
                        insufficientSection.classList.remove('hidden');
                        insufficientBtn.classList.add('border-indigo-500', 'text-indigo-600', 'active');
                        insufficientBtn.classList.remove('border-transparent', 'text-gray-500');
                        exportedBtn.classList.remove('border-indigo-500', 'text-indigo-600', 'active');
                        exportedBtn.classList.add('border-transparent', 'text-gray-500');
                    }
                }

                // Display exported materials table (ƒë·ªß kho)
                function displayExportedMaterialsTable(data) {
                    const tbody = document.getElementById('exportedMaterialsTable');

                    if (!data || data.length === 0) {
                        tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-4 py-8 text-center text-gray-500">
                            Ch∆∞a c√≥ v·∫≠t t∆∞ n√†o ƒë√£ xu·∫•t (ƒë·ªß kho)
                        </td>
                    </tr>`;
                        return;
                    }

                    const getTypeName = (type) => {
                        const names = {
                            'accessory': 'Ph·ª• ki·ªán',
                            'aluminum': 'H·ªá nh√¥m',
                            'glass': 'K√≠nh',
                            'other': 'Kh√°c'
                        };
                        return names[type] || type;
                    };

                    const getTypeColor = (type) => {
                        const colors = {
                            'accessory': 'bg-blue-100 text-blue-700',
                            'aluminum': 'bg-green-100 text-green-700',
                            'glass': 'bg-purple-100 text-purple-700',
                            'other': 'bg-gray-100 text-gray-700'
                        };
                        return colors[type] || 'bg-gray-100 text-gray-700';
                    };

                    const escapeHtml = (str) => {
                        if (!str) return '';
                        const div = document.createElement('div');
                        div.textContent = String(str);
                        return div.innerHTML;
                    };

                    tbody.innerHTML = data.map(mat => {
                        try {
                            const materialName = mat.material_name || mat.item_name || mat.name || 'N/A';
                            const materialType = mat.material_type || 'other';
                            const quantity = parseFloat(mat.quantity) || 0;
                            const unit = mat.unit || mat.item_unit || 'c√°i';
                            const unitPrice = parseFloat(mat.unit_price) || 0;
                            const totalCost = parseFloat(mat.total_cost) || (quantity * unitPrice);
                            const availableStock = parseFloat(mat.available_stock) || 0;
                            const notes = mat.notes || '';
                            // ƒê·∫£m b·∫£o notes l√† string v√† escape ƒë√∫ng c√°ch ƒë·ªÉ tr√°nh l·ªói syntax
                            let safeNotes = '';
                            try {
                                safeNotes = typeof notes === 'string' ? notes.replace(/\\/g, '\\\\').replace(/"/g, '\\"').replace(/\n/g, '\\n').replace(/\r/g, '\\r') : String(notes || '');
                            } catch (e) {
                                safeNotes = String(notes || '');
                            }

                            const safeMaterialName = typeof materialName === 'string'
                                ? materialName.replace(/\\/g, '\\\\').replace(/"/g, '\\"').replace(/\n/g, '\\n').replace(/\r/g, '\\r')
                                : String(materialName || '');

                            // S·ª≠ d·ª•ng data attributes thay v√¨ inline onclick ƒë·ªÉ tr√°nh l·ªói syntax
                            const editId = `edit-${mat.id}`;
                            const deleteId = `delete-${mat.id}`;

                            return `
                        <tr class="hover:bg-gray-50">
                            <td class="px-4 py-3 font-medium">${escapeHtml(materialName)}</td>
                            <td class="px-4 py-3">
                                <span class="px-2 py-1 text-xs rounded ${getTypeColor(materialType)}">${getTypeName(materialType)}</span>
                            </td>
                            <td class="px-4 py-3">${quantity.toFixed(2)} ${unit}</td>
                            <td class="px-4 py-3">${formatCurrency(unitPrice)}</td>
                            <td class="px-4 py-3 font-medium text-green-600">${formatCurrency(totalCost)}</td>
                            <td class="px-4 py-3 text-green-600 font-semibold">${availableStock.toFixed(2)} ${unit}</td>
                            <td class="px-4 py-3 text-gray-500 text-sm">${escapeHtml(notes) || '-'}</td>
                            <td class="px-4 py-3">
                                <div class="flex gap-2">
                                    <button id="${editId}" data-id="${mat.id}" data-name="${safeMaterialName.replace(/"/g, '&quot;')}" data-quantity="${quantity}" data-notes="${safeNotes.replace(/"/g, '&quot;')}"
                                            class="text-blue-600 hover:text-blue-800 edit-material-btn" title="S·ª≠a">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-5 h-5">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                        </svg>
                                    </button>
                                    <button id="${deleteId}" data-id="${mat.id}" data-name="${safeMaterialName.replace(/"/g, '&quot;')}"
                                            class="text-red-600 hover:text-red-800 delete-material-btn" title="X√≥a">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-5 h-5">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        </tr>`;
                        } catch (err) {
                            console.error('Error rendering material:', mat, err);
                            return '';
                        }
                    }).join('');

                    // Attach event listeners sau khi render ƒë·ªÉ tr√°nh l·ªói syntax
                    setTimeout(() => {
                        document.querySelectorAll('#exportedMaterialsTable .edit-material-btn').forEach(btn => {
                            btn.addEventListener('click', function () {
                                const id = this.getAttribute('data-id');
                                const name = this.getAttribute('data-name');
                                const quantity = parseFloat(this.getAttribute('data-quantity')) || 0;
                                const notes = this.getAttribute('data-notes') || '';
                                openEditMaterial(id, name, quantity, notes);
                            });
                        });

                        document.querySelectorAll('#exportedMaterialsTable .delete-material-btn').forEach(btn => {
                            btn.addEventListener('click', function () {
                                const id = this.getAttribute('data-id');
                                const name = this.getAttribute('data-name');
                                deleteProjectMaterial(id, name);
                            });
                        });
                    }, 100);
                }

                // Display insufficient materials table (thi·∫øu kho)
                function displayInsufficientMaterialsTable(data) {
                    const tbody = document.getElementById('insufficientMaterialsTable');

                    if (!data || data.length === 0) {
                        tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="px-4 py-8 text-center text-gray-500">
                            Kh√¥ng c√≥ v·∫≠t t∆∞ ch∆∞a ƒë·ªß (t·∫•t c·∫£ ƒë·ªÅu ƒë·ªß kho)
                        </td>
                    </tr>`;
                        return;
                    }

                    const getTypeName = (type) => {
                        const names = {
                            'accessory': 'Ph·ª• ki·ªán',
                            'aluminum': 'H·ªá nh√¥m',
                            'glass': 'K√≠nh',
                            'other': 'Kh√°c'
                        };
                        return names[type] || type;
                    };

                    const getTypeColor = (type) => {
                        const colors = {
                            'accessory': 'bg-blue-100 text-blue-700',
                            'aluminum': 'bg-green-100 text-green-700',
                            'glass': 'bg-purple-100 text-purple-700',
                            'other': 'bg-gray-100 text-gray-700'
                        };
                        return colors[type] || 'bg-gray-100 text-gray-700';
                    };

                    const getStockStatusBadge = (status) => {
                        const badges = {
                            'not_found': '<span class="px-2 py-1 text-xs rounded bg-gray-100 text-gray-700">‚äò Kh√¥ng c√≥ trong kho</span>',
                            'shortage': '<span class="px-2 py-1 text-xs rounded bg-red-100 text-red-700">‚úó H·∫øt kho</span>',
                            'partial': '<span class="px-2 py-1 text-xs rounded bg-yellow-100 text-yellow-700">‚ö† Thi·∫øu m·ªôt ph·∫ßn</span>'
                        };
                        return badges[status] || '<span class="px-2 py-1 text-xs rounded bg-gray-100 text-gray-700">-</span>';
                    };

                    const escapeHtml = (str) => {
                        if (!str) return '';
                        const div = document.createElement('div');
                        div.textContent = String(str);
                        return div.innerHTML;
                    };

                    tbody.innerHTML = data.map(mat => {
                        try {
                            const materialName = mat.material_name || mat.item_name || mat.name || 'N/A';
                            const materialType = mat.material_type || 'other';
                            const requiredQty = parseFloat(mat.quantity) || 0;
                            const unit = mat.unit || mat.item_unit || 'c√°i';
                            const availableStock = parseFloat(mat.available_stock) || 0;
                            const shortage = parseFloat(mat.shortage) || 0;
                            const stockStatus = mat.stock_status || 'unknown';
                            const stockNote = mat.stock_note || '';
                            const notes = mat.notes || '';
                            // ƒê·∫£m b·∫£o materialName l√† string v√† escape ƒë√∫ng c√°ch
                            const safeMaterialName = typeof materialName === 'string'
                                ? materialName.replace(/\\/g, '\\\\').replace(/"/g, '\\"').replace(/\n/g, '\\n').replace(/\r/g, '\\r')
                                : String(materialName || '');

                            // S·ª≠ d·ª•ng data attributes thay v√¨ inline onclick
                            const deleteId = `delete-insufficient-${mat.id}`;

                            return `
                        <tr class="hover:bg-gray-50 ${stockStatus === 'not_found' ? 'bg-gray-50' : ''}">
                            <td class="px-4 py-3 font-medium">${escapeHtml(materialName)}</td>
                            <td class="px-4 py-3">
                                <span class="px-2 py-1 text-xs rounded ${getTypeColor(materialType)}">${getTypeName(materialType)}</span>
                            </td>
                            <td class="px-4 py-3">${requiredQty.toFixed(2)} ${unit}</td>
                            <td class="px-4 py-3">${stockStatus === 'not_found' ? '-' : availableStock.toFixed(2)} ${stockStatus === 'not_found' ? '' : unit}</td>
                            <td class="px-4 py-3 text-red-600 font-semibold">${shortage > 0 ? shortage.toFixed(2) + ' ' + unit : '-'}</td>
                            <td class="px-4 py-3">${getStockStatusBadge(stockStatus)}</td>
                            <td class="px-4 py-3 text-gray-500 text-sm">${escapeHtml(stockNote) || escapeHtml(notes) || '-'}</td>
                            <td class="px-4 py-3">
                                <div class="flex gap-2">
                                    <button id="${deleteId}" data-id="${mat.id}" data-name="${safeMaterialName.replace(/"/g, '&quot;')}"
                                            class="text-red-600 hover:text-red-800 delete-material-btn" title="X√≥a">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-5 h-5">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        </tr>`;
                        } catch (err) {
                            console.error('Error rendering insufficient material:', mat, err);
                            return '';
                        }
                    }).join('');

                    // Attach event listeners sau khi render ƒë·ªÉ tr√°nh l·ªói syntax
                    setTimeout(() => {
                        document.querySelectorAll('#insufficientMaterialsTable .delete-material-btn').forEach(btn => {
                            btn.addEventListener('click', function () {
                                const id = this.getAttribute('data-id');
                                const name = this.getAttribute('data-name');
                                deleteProjectMaterial(id, name);
                            });
                        });
                    }, 100);
                }

                // Filter exported materials
                function filterExportedMaterials() {
                    // TODO: Implement filter logic
                    console.log('Filter exported materials');
                }

                // Open add material modal
                function openAddMaterialModal() {
                    if (!selectedProjectId) {
                        alert('Vui l√≤ng ch·ªçn d·ª± √°n tr∆∞·ªõc');
                        return;
                    }

                    document.getElementById('addMaterialModal').classList.remove('hidden');

                    // Reset
                    document.getElementById('inventorySelectTable').innerHTML = `
                <tr>
                    <td colspan="6" class="px-3 py-8 text-center text-gray-500">
                        ƒêang t·∫£i d·ªØ li·ªáu...
                    </td>
                </tr>`;

                    // Clear search
                    const searchInput = document.getElementById('materialSearchInput');
                    if (searchInput) searchInput.value = '';

                    allInventoryDataForExport = [];
                    inventoryDataForExport = [];
                    updateSelectedCount();

                    // Reset v·ªÅ tab Ph·ª• ki·ªán
                    currentMaterialTypeInModal = 'accessory';
                    const tabs = document.querySelectorAll('.material-type-tab');
                    tabs.forEach(tab => {
                        tab.classList.remove('active', 'border-indigo-500', 'text-indigo-600');
                        tab.classList.add('border-transparent', 'text-gray-600');
                    });
                    const accessoryTab = document.querySelector('.material-type-tab[data-type="accessory"]');
                    if (accessoryTab) {
                        accessoryTab.classList.add('active', 'border-indigo-500', 'text-indigo-600');
                        accessoryTab.classList.remove('border-transparent', 'text-gray-600');
                    }

                    // Load v·∫≠t t∆∞ theo lo·∫°i ƒë∆∞·ª£c ch·ªçn
                    loadInventoryByTypeForModal('accessory');
                }

                // Close add material modal
                function closeAddMaterialModal() {
                    document.getElementById('addMaterialModal').classList.add('hidden');
                }

                // Switch material type tab
                function switchMaterialType(type, buttonElement) {
                    currentMaterialTypeInModal = type;

                    // Update tab active state
                    document.querySelectorAll('.material-type-tab').forEach(tab => {
                        tab.classList.remove('active', 'border-indigo-500', 'text-indigo-600');
                        tab.classList.add('border-transparent', 'text-gray-600');
                    });
                    if (buttonElement) {
                        buttonElement.classList.add('active', 'border-indigo-500', 'text-indigo-600');
                        buttonElement.classList.remove('border-transparent', 'text-gray-600');
                    }

                    // Clear search
                    const searchInput = document.getElementById('materialSearchInput');
                    if (searchInput) searchInput.value = '';

                    // Load v·∫≠t t∆∞ theo lo·∫°i
                    loadInventoryByTypeForModal(type);
                }

                // Load v·∫≠t t∆∞ theo lo·∫°i cho modal
                async function loadInventoryByTypeForModal(type) {
                    const tbody = document.getElementById('inventorySelectTable');
                    if (!tbody) return;

                    tbody.innerHTML = `
                <tr>
                    <td colspan="6" class="px-3 py-8 text-center text-gray-500">
                        ƒêang t·∫£i d·ªØ li·ªáu...
                    </td>
                </tr>`;

                    try {
                        const response = await fetch(`${API_BASE}/project-materials/inventory/${type}`);
                        const result = await response.json();

                        if (result.success && result.data) {
                            const items = result.data.map(item => ({
                                ...item,
                                code: item.code || item.item_code || '',
                                name: item.name || item.item_name || '',
                                unit: item.unit || item.item_unit || 'c√°i',
                                price: parseFloat(item.price || item.unit_price || 0),
                                stock: parseFloat(item.stock || item.stock_quantity || item.quantity || 0),
                                material_type: type,
                                selected: false,
                                quantity: 0,
                                notes: ''
                            }));

                            allInventoryDataForExport = items;
                            inventoryDataForExport = items;
                            displayInventoryTable(items);
                        } else {
                            allInventoryDataForExport = [];
                            inventoryDataForExport = [];
                            tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="px-3 py-8 text-center text-gray-500">
                                Kh√¥ng c√≥ d·ªØ li·ªáu
                            </td>
                        </tr>`;
                        }
                    } catch (error) {
                        console.error('L·ªói load v·∫≠t t∆∞:', error);
                        allInventoryDataForExport = [];
                        inventoryDataForExport = [];
                        tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-3 py-8 text-center text-red-500">
                            L·ªói khi t·∫£i d·ªØ li·ªáu: ${error.message}
                        </td>
                    </tr>`;
                    }
                }

                // Display inventory table in modal
                function displayInventoryTable(items) {
                    const tbody = document.getElementById('inventorySelectTable');
                    if (!tbody) return;

                    if (!items || items.length === 0) {
                        tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-3 py-8 text-center text-gray-500">
                            Kh√¥ng c√≥ d·ªØ li·ªáu
                        </td>
                    </tr>`;
                        return;
                    }

                    const escapeHtml = (str) => {
                        if (!str) return '';
                        const div = document.createElement('div');
                        div.textContent = String(str);
                        return div.innerHTML;
                    };

                    tbody.innerHTML = items.map((item, index) => {
                        const stock = parseFloat(item.stock) || 0;
                        const price = parseFloat(item.price) || 0;
                        const isDisabled = stock === 0;
                        const itemId = `material_${index}`;

                        return `
                    <tr class="hover:bg-gray-50 ${isDisabled ? 'bg-gray-50 opacity-60' : ''}">
                        <td class="px-3 py-3">
                            <input type="checkbox" 
                                id="${itemId}" 
                                data-index="${index}"
                                onchange="toggleMaterialSelection(${index})"
                                ${isDisabled ? 'disabled' : ''}
                                class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                        </td>
                        <td class="px-3 py-3">
                            <div class="font-medium text-gray-900">${escapeHtml(item.name)}</div>
                            ${item.code ? `<div class="text-xs text-gray-500">${escapeHtml(item.code)}</div>` : ''}
                        </td>
                        <td class="px-3 py-3">
                            <span class="font-semibold ${stock > 0 ? 'text-green-600' : 'text-red-600'}">
                                ${stock.toFixed(2)} ${item.unit}
                            </span>
                        </td>
                        <td class="px-3 py-3">${formatCurrency(price)}</td>
                        <td class="px-3 py-3">
                            <input type="number" 
                                id="qty_${index}"
                                data-index="${index}"
                                step="0.01" 
                                min="0" 
                                max="${stock}"
                                value="0"
                                oninput="validateQuantityInput(this, ${stock}, ${index})"
                                ${isDisabled ? 'disabled' : ''}
                                class="w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 ${isDisabled ? 'bg-gray-100' : ''}">
                        </td>
                        <td class="px-3 py-3">
                            <input type="text" 
                                id="notes_${index}"
                                data-index="${index}"
                                placeholder="Ghi ch√∫..."
                                onchange="updateMaterialNotes(${index})"
                                class="w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </td>
                    </tr>`;
                    }).join('');

                    updateSelectedCount();
                }

                // Filter materials
                function filterMaterials() {
                    const searchInput = document.getElementById('materialSearchInput');
                    if (!searchInput) return;

                    const searchTerm = searchInput.value.toLowerCase().trim();

                    if (!allInventoryDataForExport || allInventoryDataForExport.length === 0) {
                        return;
                    }

                    if (!searchTerm) {
                        inventoryDataForExport = [...allInventoryDataForExport];
                    } else {
                        inventoryDataForExport = allInventoryDataForExport.filter(item => {
                            const name = (item.name || '').toLowerCase();
                            const code = (item.code || '').toLowerCase();
                            return name.includes(searchTerm) || code.includes(searchTerm);
                        });
                    }

                    displayInventoryTable(inventoryDataForExport);
                }

                // Toggle material selection
                function toggleMaterialSelection(index) {
                    if (inventoryDataForExport[index]) {
                        inventoryDataForExport[index].selected = !inventoryDataForExport[index].selected;
                        const checkbox = document.getElementById(`material_${index}`);
                        if (checkbox) {
                            checkbox.checked = inventoryDataForExport[index].selected;
                        }
                        updateSelectedCount();
                    }
                }

                // Toggle select all materials
                function toggleSelectAllMaterials() {
                    const selectAll = document.getElementById('selectAllMaterials');
                    const isChecked = selectAll.checked;

                    inventoryDataForExport.forEach((item, index) => {
                        if (item.stock > 0) { // Ch·ªâ ch·ªçn nh·ªØng v·∫≠t t∆∞ c√≥ t·ªìn kho
                            item.selected = isChecked;
                            const checkbox = document.getElementById(`material_${index}`);
                            if (checkbox) {
                                checkbox.checked = isChecked;
                            }
                        }
                    });

                    updateSelectedCount();
                }

                // Validate quantity input
                function validateQuantityInput(inputElement, availableStock, index) {
                    const value = parseFloat(inputElement.value) || 0;

                    if (availableStock === 0) {
                        inputElement.value = '0';
                        inputElement.disabled = true;
                        inputElement.classList.add('bg-gray-100');
                        return;
                    }

                    if (value > availableStock) {
                        inputElement.value = availableStock;
                        showToast('S·ªë l∆∞·ª£ng kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° t·ªìn kho', 'warning');
                    }

                    if (value > 0) {
                        // T·ª± ƒë·ªông ch·ªçn checkbox n·∫øu nh·∫≠p s·ªë l∆∞·ª£ng > 0
                        if (inventoryDataForExport[index]) {
                            inventoryDataForExport[index].selected = true;
                            inventoryDataForExport[index].quantity = parseFloat(inputElement.value) || 0;
                            const checkbox = document.getElementById(`material_${index}`);
                            if (checkbox) checkbox.checked = true;
                        }
                    }

                    if (inventoryDataForExport[index]) {
                        inventoryDataForExport[index].quantity = parseFloat(inputElement.value) || 0;
                    }

                    updateSelectedCount();
                }

                // Update material notes
                function updateMaterialNotes(index) {
                    const notesInput = document.getElementById(`notes_${index}`);
                    if (notesInput && inventoryDataForExport[index]) {
                        inventoryDataForExport[index].notes = notesInput.value || '';
                    }
                }

                // Update selected count
                function updateSelectedCount() {
                    const selectedCount = inventoryDataForExport.filter(item => item.selected && item.quantity > 0).length;
                    const countElement = document.getElementById('selectedMaterialsCount');
                    if (countElement) {
                        countElement.innerHTML = `ƒê√£ ch·ªçn: <span class="text-indigo-600 font-bold">${selectedCount}</span> v·∫≠t t∆∞`;
                    }
                }

                // Add selected materials to project
                async function addSelectedMaterials() {
                    if (!selectedProjectId) {
                        alert('Vui l√≤ng ch·ªçn d·ª± √°n tr∆∞·ªõc');
                        return;
                    }

                    const selectedMaterials = inventoryDataForExport.filter(item =>
                        item.selected && item.quantity > 0
                    );

                    if (selectedMaterials.length === 0) {
                        alert('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt v·∫≠t t∆∞ v√† nh·∫≠p s·ªë l∆∞·ª£ng');
                        return;
                    }

                    // Validate stock before adding
                    const insufficientItems = [];
                    const materials = [];

                    for (const item of selectedMaterials) {
                        const requestedQty = parseFloat(item.quantity) || 0;
                        const availableStock = parseFloat(item.stock) || 0;

                        if (requestedQty > availableStock) {
                            insufficientItems.push({
                                name: item.name,
                                required: requestedQty,
                                available: availableStock,
                                reason: availableStock === 0 ? 'kh√¥ng_c√≥' : 'kh√¥ng_ƒë·ªß'
                            });
                        } else if (requestedQty > 0) {
                            materials.push({
                                material_type: item.material_type,
                                material_id: item.id,
                                material_name: item.name,
                                quantity: requestedQty,
                                unit: item.unit,
                                unit_price: parseFloat(item.price) || 0,
                                notes: item.notes || ''
                            });
                        }
                    }

                    // Show alert if there are insufficient items
                    if (insufficientItems.length > 0) {
                        let message = '‚ùå KH√îNG TH·ªÇ TH√äM V·∫¨T T∆Ø!\n\n';
                        const noStockItems = insufficientItems.filter(i => i.reason === 'kh√¥ng_c√≥');
                        const insufficientItemsList = insufficientItems.filter(i => i.reason === 'kh√¥ng_ƒë·ªß');

                        if (noStockItems.length > 0) {
                            message += `C√≥ ${noStockItems.length} v·∫≠t t∆∞ KH√îNG C√ì trong kho:\n`;
                            noStockItems.forEach(item => {
                                message += `‚Ä¢ ${item.name}: T·ªìn kho = 0\n`;
                            });
                            message += '\n';
                        }

                        if (insufficientItemsList.length > 0) {
                            message += `C√≥ ${insufficientItemsList.length} v·∫≠t t∆∞ KH√îNG ƒê·ª¶ s·ªë l∆∞·ª£ng:\n`;
                            insufficientItemsList.forEach(item => {
                                message += `‚Ä¢ ${item.name}: C·∫ßn ${item.required}, kho c√≥ ${item.available}\n`;
                            });
                        }

                        alert(message);

                        if (materials.length === 0) {
                            return; // Kh√¥ng c√≥ v·∫≠t t∆∞ n√†o ƒë·ªß ƒë·ªÉ th√™m
                        }
                    }

                    // Add materials to project
                    try {
                        const response = await fetch(`${API_BASE}/project-materials`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                project_id: parseInt(selectedProjectId),
                                materials
                            })
                        });

                        const result = await response.json();

                        if (result.success) {
                            showToast(`ƒê√£ th√™m ${materials.length} v·∫≠t t∆∞ v√†o d·ª± √°n th√†nh c√¥ng!`, 'success');
                            closeAddMaterialModal();
                            loadProjectMaterials();
                            loadExportedMaterials();
                        } else {
                            if (result.insufficient_materials && result.insufficient_materials.length > 0) {
                                let message = '‚ùå KH√îNG TH·ªÇ TH√äM V·∫¨T T∆Ø!\n\n';
                                result.insufficient_materials.forEach(item => {
                                    message += `‚Ä¢ ${item.name}: ${item.message}\n`;
                                });
                                alert(message);
                            } else {
                                alert('L·ªói: ' + (result.message || 'Kh√¥ng th·ªÉ th√™m v·∫≠t t∆∞'));
                            }
                        }
                    } catch (error) {
                        console.error('L·ªói th√™m v·∫≠t t∆∞:', error);
                        alert('L·ªói khi th√™m v·∫≠t t∆∞. Vui l√≤ng th·ª≠ l·∫°i.');
                    }
                }

                // Show toast notification
                function showToast(message, type = 'info') {
                    // Simple alert for now, can be enhanced with a toast library
                    if (type === 'success') {
                        console.log('‚úÖ', message);
                    } else if (type === 'warning') {
                        console.warn('‚ö†Ô∏è', message);
                    } else {
                        console.log('‚ÑπÔ∏è', message);
                    }
                }

                // Confirm material export
                async function confirmMaterialExport() {
                    if (!selectedProjectId) {
                        alert('Vui l√≤ng ch·ªçn d·ª± √°n tr∆∞·ªõc');
                        return;
                    }

                    try {
                        const checkResponse = await fetch(`${API_BASE}/project-materials/check-export-requirement/${selectedProjectId}`);
                        const checkResult = await checkResponse.json();

                        if (checkResult.success && checkResult.insufficient_count > 0) {
                            alert('Kh√¥ng th·ªÉ x√°c nh·∫≠n xu·∫•t v·∫≠t t∆∞! V·∫´n c√≤n v·∫≠t t∆∞ thi·∫øu kho. Vui l√≤ng b·ªï sung ho·∫∑c ƒëi·ªÅu ch·ªânh s·ªë l∆∞·ª£ng.');
                            return;
                        }

                        if (!confirm('X√°c nh·∫≠n xu·∫•t v·∫≠t t∆∞ v√† chuy·ªÉn d·ª± √°n sang giai ƒëo·∫°n S·∫£n xu·∫•t?')) {
                            return;
                        }

                        const response = await fetch(`${API_BASE}/project-materials/confirm-export/${selectedProjectId}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        });

                        const result = await response.json();

                        if (result.success) {
                            alert('ƒê√£ x√°c nh·∫≠n xu·∫•t v·∫≠t t∆∞ th√†nh c√¥ng! D·ª± √°n ƒë√£ chuy·ªÉn sang giai ƒëo·∫°n S·∫£n xu·∫•t.');
                            loadProjectMaterials();
                            loadExportedMaterials();
                        } else {
                            alert('L·ªói: ' + (result.message || 'Kh√¥ng th·ªÉ x√°c nh·∫≠n xu·∫•t v·∫≠t t∆∞'));
                        }
                    } catch (error) {
                        console.error('L·ªói x√°c nh·∫≠n xu·∫•t v·∫≠t t∆∞:', error);
                        alert('L·ªói khi x√°c nh·∫≠n xu·∫•t v·∫≠t t∆∞. Vui l√≤ng th·ª≠ l·∫°i.');
                    }
                }

                // Open edit material modal
                function openEditMaterial(id, name, quantity, notes) {
                    try {
                        const modal = document.getElementById('editMaterialModal');
                        if (!modal) {
                            console.error('Modal editMaterialModal not found');
                            alert('Kh√¥ng t√¨m th·∫•y form ch·ªânh s·ª≠a. Vui l√≤ng t·∫£i l·∫°i trang.');
                            return;
                        }

                        document.getElementById('editMaterialId').value = id || '';
                        document.getElementById('editMaterialName').value = (name && typeof name === 'string') ? name : String(name || '');
                        document.getElementById('editMaterialQuantity').value = parseFloat(quantity) || 0;
                        document.getElementById('editMaterialNotes').value = (notes && typeof notes === 'string') ? notes : String(notes || '');
                        modal.classList.remove('hidden');
                    } catch (error) {
                        console.error('Error opening edit modal:', error);
                        alert('L·ªói khi m·ªü form ch·ªânh s·ª≠a: ' + error.message);
                    }
                }

                // Close edit material modal
                function closeEditMaterialModal() {
                    document.getElementById('editMaterialModal').classList.add('hidden');
                    document.getElementById('editMaterialForm').reset();
                }

                // Save edit material
                async function saveEditMaterial(event) {
                    event.preventDefault();

                    const id = document.getElementById('editMaterialId').value;
                    const quantity = parseFloat(document.getElementById('editMaterialQuantity').value) || 0;
                    const notes = document.getElementById('editMaterialNotes').value || '';

                    if (quantity <= 0) {
                        alert('S·ªë l∆∞·ª£ng ph·∫£i l·ªõn h∆°n 0');
                        return;
                    }

                    try {
                        const response = await fetch(`${API_BASE}/project-materials/${id}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                quantity: quantity,
                                notes: notes
                            })
                        });

                        const result = await response.json();

                        if (result.success) {
                            showToast('ƒê√£ c·∫≠p nh·∫≠t v·∫≠t t∆∞ th√†nh c√¥ng!', 'success');
                            closeEditMaterialModal();
                            loadProjectMaterials();
                            loadExportedMaterials();
                        } else {
                            alert('L·ªói: ' + (result.message || 'Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t v·∫≠t t∆∞'));
                        }
                    } catch (error) {
                        console.error('L·ªói c·∫≠p nh·∫≠t v·∫≠t t∆∞:', error);
                        alert('L·ªói khi c·∫≠p nh·∫≠t v·∫≠t t∆∞. Vui l√≤ng th·ª≠ l·∫°i.');
                    }
                }

                // Delete project material
                async function deleteProjectMaterial(id, name) {
                    try {
                        const safeName = (name && typeof name === 'string') ? name : String(name || 'V·∫≠t t∆∞');

                        if (!confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a v·∫≠t t∆∞ "${safeName}"?`)) {
                            return;
                        }

                        if (!id) {
                            alert('L·ªói: Kh√¥ng t√¨m th·∫•y ID v·∫≠t t∆∞');
                            return;
                        }

                        const response = await fetch(`${API_BASE}/project-materials/${id}`, {
                            method: 'DELETE'
                        });

                        if (!response.ok) {
                            const errorText = await response.text();
                            throw new Error(`HTTP ${response.status}: ${errorText}`);
                        }

                        const result = await response.json();

                        if (result.success) {
                            alert('ƒê√£ x√≥a v·∫≠t t∆∞ th√†nh c√¥ng!');
                            loadProjectMaterials();
                            loadExportedMaterials();
                        } else {
                            alert('L·ªói: ' + (result.message || 'Kh√¥ng th·ªÉ x√≥a v·∫≠t t∆∞'));
                        }
                    } catch (error) {
                        console.error('L·ªói x√≥a v·∫≠t t∆∞:', error);
                        alert('L·ªói khi x√≥a v·∫≠t t∆∞: ' + error.message);
                    }
                }

                // Initialize
                document.addEventListener('DOMContentLoaded', function () {
                    loadCompanyLogo();
                    loadSidebarUserInfo();
                    loadHeaderUserInfo();
                    if (checkAuth()) {
                        // ƒê·∫£m b·∫£o hi·ªÉn th·ªã giao di·ªán nh∆∞ ·∫£nh 1 (danh s√°ch d·ª± √°n ƒë√£ xu·∫•t v·∫≠t t∆∞ v·ªõi n√∫t "Kho v·∫≠t t∆∞")
                        // ·∫®n ph·∫ßn "Ch·ªçn d·ª± √°n ƒë·ªÉ xu·∫•t v·∫≠t t∆∞" (projectListSection)
                        const projectListSection = document.getElementById('projectListSection');
                        const exportMaterialsSection = document.getElementById('exportMaterialsSection');

                        if (projectListSection) projectListSection.classList.add('hidden');
                        if (exportMaterialsSection) exportMaterialsSection.classList.add('hidden');

                        // Ch·ªâ load danh s√°ch d·ª± √°n ƒë√£ xu·∫•t v·∫≠t t∆∞ (·∫£nh 1)
                        loadExportedMaterials();
                    }
                });

                // ========================================
                // PHI·∫æU XU·∫§T KHO - MODAL & EXCEL EXPORT
                // ========================================

                // Bi·∫øn l∆∞u d·ªØ li·ªáu phi·∫øu xu·∫•t hi·ªán t·∫°i
                let currentExportSlipData = null;

                /**
                 * Hi·ªÉn th·ªã modal chi ti·∫øt phi·∫øu xu·∫•t kho
                 */
                function showExportSlipModal() {
                    if (!selectedProject || !exportedMaterialsList || exportedMaterialsList.length === 0) {
                        alert('Ch∆∞a c√≥ d·ªØ li·ªáu v·∫≠t t∆∞ ƒë√£ xu·∫•t ƒë·ªÉ t·∫°o phi·∫øu!');
                        return;
                    }

                    const now = new Date();
                    const slipCode = `PXK-${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}-${String(selectedProject.id).padStart(3, '0')}`;
                    const exportDate = formatDateTime(now);

                    // T√≠nh t·ªïng gi√° tr·ªã
                    const totalValue = exportedMaterialsList.reduce((sum, m) => sum + (parseFloat(m.total_cost) || 0), 0);

                    // L∆∞u data ƒë·ªÉ export Excel
                    currentExportSlipData = {
                        slipCode,
                        exportDate,
                        project: selectedProject,
                        materials: exportedMaterialsList,
                        totalValue: totalValue
                    };

                    // T·∫°o HTML b·∫£ng v·∫≠t t∆∞
                    let materialsTableHTML = '';
                    exportedMaterialsList.forEach((m, idx) => {
                        const exportDateStr = m.created_at ? formatDateTime(new Date(m.created_at)) : '-';
                        materialsTableHTML += `
                        <tr class="border-b border-gray-100">
                            <td class="px-3 py-2 text-center">${idx + 1}</td>
                            <td class="px-3 py-2">${escapeHtml(m.material_name || m.item_name || 'N/A')}</td>
                            <td class="px-3 py-2 text-center">${getMaterialTypeName(m.material_type)}</td>
                            <td class="px-3 py-2 text-center">${m.quantity || 0}</td>
                            <td class="px-3 py-2 text-center">${m.unit || 'c√°i'}</td>
                            <td class="px-3 py-2 text-right">${formatCurrency(m.unit_price || 0)}</td>
                            <td class="px-3 py-2 text-right">${formatCurrency(m.total_cost || 0)}</td>
                            <td class="px-3 py-2 text-center text-sm text-gray-500">${exportDateStr}</td>
                        </tr>
                    `;
                    });

                    const modalHTML = `
                    <div id="exportSlipModal" class="fixed inset-0 bg-black bg-opacity-50 z-[10001] flex items-center justify-center">
                        <div class="bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col">
                            <!-- Header -->
                            <div class="bg-gradient-to-r from-indigo-600 to-blue-600 text-white px-6 py-4">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <h2 class="text-xl font-bold">üìÑ PHI·∫æU XU·∫§T KHO V·∫¨T T∆Ø</h2>
                                        <p class="text-indigo-100 text-sm">M√£ phi·∫øu: ${slipCode}</p>
                                    </div>
                                    <button onclick="closeExportSlipModal()" class="text-white hover:bg-white/20 p-2 rounded-lg transition">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-6 h-6">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                            </div>

                            <!-- Body -->
                            <div class="overflow-y-auto flex-1 p-6">
                                <!-- Th√¥ng tin phi·∫øu -->
                                <div class="grid grid-cols-2 gap-6 mb-6">
                                    <div class="bg-gray-50 rounded-lg p-4">
                                        <h3 class="font-semibold text-gray-700 mb-2">Th√¥ng tin d·ª± √°n</h3>
                                        <p><span class="text-gray-500">M√£ d·ª± √°n:</span> <span class="font-medium">${selectedProject.project_code || '-'}</span></p>
                                        <p><span class="text-gray-500">T√™n d·ª± √°n:</span> <span class="font-medium">${selectedProject.project_name || selectedProject.name || '-'}</span></p>
                                        <p><span class="text-gray-500">Kh√°ch h√†ng:</span> <span class="font-medium">${selectedProject.customer_name || '-'}</span></p>
                                    </div>
                                    <div class="bg-gray-50 rounded-lg p-4">
                                        <h3 class="font-semibold text-gray-700 mb-2">Th√¥ng tin phi·∫øu</h3>
                                        <p><span class="text-gray-500">M√£ phi·∫øu:</span> <span class="font-medium text-indigo-600">${slipCode}</span></p>
                                        <p><span class="text-gray-500">Ng√†y xu·∫•t:</span> <span class="font-medium">${exportDate}</span></p>
                                        <p><span class="text-gray-500">S·ªë lo·∫°i v·∫≠t t∆∞:</span> <span class="font-medium">${exportedMaterialsList.length}</span></p>
                                    </div>
                                </div>

                                <!-- B·∫£ng v·∫≠t t∆∞ -->
                                <div class="border rounded-lg overflow-hidden mb-4">
                                    <table class="w-full">
                                        <thead class="bg-gray-100">
                                            <tr>
                                                <th class="px-3 py-2 text-xs font-semibold text-gray-600 text-center">STT</th>
                                                <th class="px-3 py-2 text-xs font-semibold text-gray-600 text-left">T√äN V·∫¨T T∆Ø</th>
                                                <th class="px-3 py-2 text-xs font-semibold text-gray-600 text-center">LO·∫†I</th>
                                                <th class="px-3 py-2 text-xs font-semibold text-gray-600 text-center">S·ªê L∆Ø·ª¢NG</th>
                                                <th class="px-3 py-2 text-xs font-semibold text-gray-600 text-center">ƒêVT</th>
                                                <th class="px-3 py-2 text-xs font-semibold text-gray-600 text-right">ƒê∆†N GI√Å</th>
                                                <th class="px-3 py-2 text-xs font-semibold text-gray-600 text-right">TH√ÄNH TI·ªÄN</th>
                                                <th class="px-3 py-2 text-xs font-semibold text-gray-600 text-center">NG√ÄY XU·∫§T</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            ${materialsTableHTML}
                                        </tbody>
                                        <tfoot class="bg-indigo-50">
                                            <tr>
                                                <td colspan="6" class="px-3 py-3 text-right font-bold text-gray-700">T·ªîNG C·ªòNG:</td>
                                                <td class="px-3 py-3 text-right font-bold text-indigo-600 text-lg">${formatCurrency(totalValue)}</td>
                                                <td></td>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>

                            <!-- Footer -->
                            <div class="px-6 py-4 bg-gray-50 border-t flex justify-between items-center">
                                <span class="text-sm text-gray-500">T·ªïng: ${exportedMaterialsList.length} v·∫≠t t∆∞ | Gi√° tr·ªã: ${formatCurrency(totalValue)}</span>
                                <div class="flex gap-3">
                                    <button onclick="closeExportSlipModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">ƒê√≥ng</button>
                                    <button onclick="exportToExcel()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-semibold flex items-center gap-2">
                                        üìä Xu·∫•t Excel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                    document.body.insertAdjacentHTML('beforeend', modalHTML);
                }

                /**
                 * ƒê√≥ng modal phi·∫øu xu·∫•t
                 */
                function closeExportSlipModal() {
                    const modal = document.getElementById('exportSlipModal');
                    if (modal) modal.remove();
                }

                /**
                 * Format ng√†y gi·ªù Vi·ªát Nam
                 */
                function formatDateTime(date) {
                    if (!date) return '-';
                    const d = new Date(date);
                    return `${String(d.getDate()).padStart(2, '0')}/${String(d.getMonth() + 1).padStart(2, '0')}/${d.getFullYear()} ${String(d.getHours()).padStart(2, '0')}:${String(d.getMinutes()).padStart(2, '0')}`;
                }

                /**
                 * L·∫•y t√™n lo·∫°i v·∫≠t t∆∞
                 */
                function getMaterialTypeName(type) {
                    const types = {
                        'accessory': 'Ph·ª• ki·ªán',
                        'aluminum': 'Nh√¥m',
                        'glass': 'K√≠nh',
                        'other': 'Kh√°c',
                        'nhom': 'Nh√¥m',
                        'kinh': 'K√≠nh',
                        'phukien': 'Ph·ª• ki·ªán'
                    };
                    return types[type] || type || 'Kh√°c';
                }

                /**
                 * Xu·∫•t Excel v·ªõi logo c√¥ng ty
                 */
                async function exportToExcel() {
                    if (!currentExportSlipData && (!selectedProject || !exportedMaterialsList)) {
                        alert('Ch∆∞a c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t Excel!');
                        return;
                    }

                    const data = currentExportSlipData || {
                        slipCode: `PXK-${Date.now()}`,
                        exportDate: formatDateTime(new Date()),
                        project: selectedProject,
                        materials: exportedMaterialsList,
                        totalValue: exportedMaterialsList.reduce((sum, m) => sum + (parseFloat(m.total_cost) || 0), 0)
                    };

                    // T·∫°o workbook
                    const wb = XLSX.utils.book_new();

                    // T·∫°o data array
                    const wsData = [
                        ['PHI·∫æU XU·∫§T KHO V·∫¨T T∆Ø'],
                        [],
                        ['C√¥ng ty:', 'ViralWindow - C·ª≠a nh√¥m k√≠nh cao c·∫•p'],
                        ['M√£ phi·∫øu:', data.slipCode],
                        ['Ng√†y xu·∫•t:', data.exportDate],
                        ['D·ª± √°n:', `${data.project.project_code || ''} - ${data.project.project_name || data.project.name || ''}`],
                        ['Kh√°ch h√†ng:', data.project.customer_name || ''],
                        [],
                        ['STT', 'T√™n v·∫≠t t∆∞', 'Lo·∫°i', 'S·ªë l∆∞·ª£ng', 'ƒêVT', 'ƒê∆°n gi√°', 'Th√†nh ti·ªÅn', 'Ng√†y xu·∫•t']
                    ];

                    // Th√™m c√°c d√≤ng v·∫≠t t∆∞
                    data.materials.forEach((m, idx) => {
                        const exportDateStr = m.created_at ? formatDateTime(new Date(m.created_at)) : '-';
                        wsData.push([
                            idx + 1,
                            m.material_name || m.item_name || 'N/A',
                            getMaterialTypeName(m.material_type),
                            m.quantity || 0,
                            m.unit || 'c√°i',
                            m.unit_price || 0,
                            m.total_cost || 0,
                            exportDateStr
                        ]);
                    });

                    // Th√™m d√≤ng t·ªïng
                    wsData.push([]);
                    wsData.push(['', '', '', '', '', 'T·ªîNG C·ªòNG:', data.totalValue, '']);

                    // T·∫°o worksheet
                    const ws = XLSX.utils.aoa_to_sheet(wsData);

                    // Set ƒë·ªô r·ªông c·ªôt
                    ws['!cols'] = [
                        { wch: 5 },   // STT
                        { wch: 35 },  // T√™n v·∫≠t t∆∞
                        { wch: 12 },  // Lo·∫°i
                        { wch: 10 },  // S·ªë l∆∞·ª£ng
                        { wch: 8 },   // ƒêVT
                        { wch: 15 },  // ƒê∆°n gi√°
                        { wch: 15 },  // Th√†nh ti·ªÅn
                        { wch: 18 }   // Ng√†y xu·∫•t
                    ];

                    // Merge cells cho ti√™u ƒë·ªÅ
                    ws['!merges'] = [
                        { s: { r: 0, c: 0 }, e: { r: 0, c: 7 } }  // Merge ti√™u ƒë·ªÅ
                    ];

                    // Append worksheet
                    XLSX.utils.book_append_sheet(wb, ws, 'Phi·∫øu xu·∫•t kho');

                    // Download file
                    const fileName = `Phieu_xuat_kho_${data.slipCode}.xlsx`;
                    XLSX.writeFile(wb, fileName);

                    alert(`‚úÖ ƒê√£ xu·∫•t file: ${fileName}`);
                }

                // Th√™m SheetJS (XLSX) library n·∫øu ch∆∞a c√≥
                if (typeof XLSX === 'undefined') {
                    const script = document.createElement('script');
                    script.src = 'https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js';
                    document.head.appendChild(script);
                }
            </script>
        </div> <!-- End main-content -->

        <!-- MODAL: Th√™m v·∫≠t t∆∞ cho d·ª± √°n -->
        <div id="addMaterialModal"
            class="hidden fixed inset-0 bg-black bg-opacity-50 z-[10000] flex items-center justify-center">
            <div class="bg-white rounded-xl p-6 w-full max-w-5xl max-h-[90vh] overflow-y-auto shadow-2xl">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Th√™m v·∫≠t t∆∞ cho d·ª± √°n</h2>
                    <button onclick="closeAddMaterialModal()" class="text-gray-500 hover:text-gray-700 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                            class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <!-- Tabs ch·ªçn lo·∫°i v·∫≠t t∆∞ -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Lo·∫°i v·∫≠t t∆∞</label>
                    <div class="flex gap-2 border-b border-gray-200">
                        <button onclick="switchMaterialType('accessory', this)"
                            class="material-type-tab px-4 py-2 font-medium text-gray-600 hover:text-indigo-600 border-b-2 border-transparent hover:border-indigo-500 active transition"
                            data-type="accessory">
                            Ph·ª• ki·ªán
                        </button>
                        <button onclick="switchMaterialType('aluminum', this)"
                            class="material-type-tab px-4 py-2 font-medium text-gray-600 hover:text-indigo-600 border-b-2 border-transparent hover:border-indigo-500 transition"
                            data-type="aluminum">
                            Kho nh√¥m
                        </button>
                        <button onclick="switchMaterialType('glass', this)"
                            class="material-type-tab px-4 py-2 font-medium text-gray-600 hover:text-indigo-600 border-b-2 border-transparent hover:border-indigo-500 transition"
                            data-type="glass">
                            K√≠nh
                        </button>
                        <button onclick="switchMaterialType('other', this)"
                            class="material-type-tab px-4 py-2 font-medium text-gray-600 hover:text-indigo-600 border-b-2 border-transparent hover:border-indigo-500 transition"
                            data-type="other">
                            V·∫≠t t∆∞ ph·ª•
                        </button>
                    </div>
                </div>

                <!-- Thanh t√¨m ki·∫øm -->
                <div class="mb-4">
                    <input type="text" id="materialSearchInput" placeholder="T√¨m ki·∫øm theo m√£, t√™n v·∫≠t t∆∞..."
                        oninput="filterMaterials()"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>

                <!-- B·∫£ng v·∫≠t t∆∞ c√≥ th·ªÉ ch·ªçn -->
                <div class="mb-4 max-h-96 overflow-y-auto border border-gray-200 rounded-lg shadow-inner">
                    <table class="w-full">
                        <thead class="bg-gray-50 sticky top-0 z-10">
                            <tr>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase w-10">
                                    <input type="checkbox" id="selectAllMaterials" onchange="toggleSelectAllMaterials()"
                                        class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                                </th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">T√äN V·∫¨T T∆Ø
                                </th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">T·ªíN KHO</th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">ƒê∆†N GI√Å</th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase w-32">S·ªê
                                    L∆Ø·ª¢NG
                                </th>
                                <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">GHI CH√ö</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200 bg-white" id="inventorySelectTable">
                            <tr>
                                <td colspan="6" class="px-3 py-8 text-center text-gray-500">
                                    ƒêang t·∫£i d·ªØ li·ªáu...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="flex justify-between items-center pt-4 border-t border-gray-200">
                    <span id="selectedMaterialsCount" class="text-sm text-gray-600 font-medium">ƒê√£ ch·ªçn: <span
                            class="text-indigo-600 font-bold">0</span> v·∫≠t t∆∞</span>
                    <div class="flex gap-4">
                        <button type="button" onclick="closeAddMaterialModal()"
                            class="px-6 py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition">
                            H·ªßy
                        </button>
                        <button type="button" onclick="addSelectedMaterials()"
                            class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition shadow-lg">
                            <span class="flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor" class="w-5 h-5">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4" />
                                </svg>
                                Th√™m v·∫≠t t∆∞ ƒë√£ ch·ªçn
                            </span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- MODAL: S·ª≠a v·∫≠t t∆∞ -->
        <div id="editMaterialModal"
            class="hidden fixed inset-0 bg-black bg-opacity-50 z-[10000] flex items-center justify-center">
            <div class="bg-white rounded-xl p-6 w-full max-w-md shadow-2xl">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">S·ª≠a v·∫≠t t∆∞</h2>
                    <button onclick="closeEditMaterialModal()" class="text-gray-500 hover:text-gray-700 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                            class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                <form id="editMaterialForm" onsubmit="saveEditMaterial(event)">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">T√™n v·∫≠t t∆∞</label>
                            <input type="text" id="editMaterialName" readonly
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">S·ªë l∆∞·ª£ng *</label>
                            <input type="number" id="editMaterialQuantity" required step="0.01" min="0.01"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Ghi ch√∫</label>
                            <textarea id="editMaterialNotes" rows="2"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                        </div>
                    </div>
                    <input type="hidden" id="editMaterialId">

                    <div class="flex justify-end gap-4 mt-6">
                        <button type="button" onclick="closeEditMaterialModal()"
                            class="px-6 py-2 border border-gray-300 rounded-lg font-medium hover:bg-gray-50 transition">H·ªßy</button>
                        <button type="submit"
                            class="bg-indigo-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-indigo-700 transition">
                            C·∫≠p nh·∫≠t
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <script src="js/sidebar-enterprise.js"></script>
        <script src="js/notification-header.js"></script>
</body>

</html>